<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:pretty="http://ocpsoft.com/prettyfaces">

<ui:composition template="templates/template.xhtml">
<ui:param name="headline" value="Edit Images"/>
	
<body>
	<ui:define name="contentMenu">
		
	</ui:define>
	
	<ui:define name="mainContent">
		<h:outputText value="#{EditImageMetadataBean.init}"/>
		<h:panelGroup styleClass="full_area0 itemBlock" >	
				
			<h:panelGroup  styleClass="full_area0 small_marginLExcl" rendered="#{SessionBean.user != null}">
				<a4j:outputPanel id="ajaxContent">
					<h:outputLabel value="#{EditImageMetadataBean.ajaxInit}"/>
				
					<!-- MAIN FORMULAR -->
					
					<!-- Selectors -->
					<h:panelGroup styleClass="huge_area0">
						<h:panelGroup styleClass="huge_area0">
							<h:outputLabel styleClass="huge_area0" value="Select metadata type"/>
							<h:selectOneMenu styleClass="xLarge_area0"  id="selStatement" value="#{EditImageMetadataBean.selectedStatementName}" valueChangeListener="#{EditImageMetadataBean.statementListener}">
								<f:selectItems value="#{EditImageMetadataBean.statementMenu}"/>
								<a4j:support event="onchange" reRender="ajaxContent" />
							</h:selectOneMenu>
						</h:panelGroup>
					</h:panelGroup>
					
					<!-- COMMON METADATA -->
					<h:panelGroup id="commonMetadata" styleClass="half_area0">
						<ui:include src="./picturesPages/ui/MetadataInput.xhtml">
							<ui:param name="metadata" value="#{EditImageMetadataBean.metadata}"/>
							<ui:param name="areaClass" value="quad_txtArea"/>
						</ui:include>
						<h:panelGroup id="modeRadioMenu" styleClass="full_area0">
							<h:selectOneRadio styleClass="huge_are0" value="#{EditImageMetadataBean.selectedMode}">
		  						<f:selectItems value="#{EditImageMetadataBean.modeRadio}" />
							</h:selectOneRadio>
						</h:panelGroup>
						<div class="half_area0 formButtonArea">
							<a4j:commandButton reRender="ajaxContent" styleClass="free_area1_p8 cancelButton"  action="#{EditImageMetadataBean.clearAll}" value="clear all"/>
							<h:outputLink value="" styleClass="free_area1_p8 cancelButton medium_marginLIncl">
									<h:outputText value="#{lbl.reset} changes" />
							</h:outputLink>
							<a4j:commandButton reRender="ajaxContent" styleClass="free_area1_p8 activeButton"  action="#{EditImageMetadataBean.addToAll}" value="Add to all"/>
						</div>
					</h:panelGroup>
					
					<br/>
					<!-- SAVE BUTTON -->
					<h:panelGroup styleClass="full_area0 preListHeader formButtonArea">
						<h:panelGroup styleClass="full_area0 formButtonArea ">
							<h:outputLink value="#{HistorySession.previousPage.uri}" styleClass="free_area1_p8 cancelButton">
								 <a4j:support event="onclick" action="#{EditImageMetadataBean.cancel}" />
								<h:outputText value="#{lbl.cancel}" />
							</h:outputLink>	
							<h:commandButton styleClass="free_area1_p8 activeButton medium_marginRExcl"  action="#{EditImageMetadataBean.editor.save}" value="#{lbl.save}"/>
						</h:panelGroup>
					</h:panelGroup>	
					
					
					<!-- IMAGES -->
					<h:panelGroup styleClass="full_area0">	
			        	<h:panelGroup id="imagesMetadata" layout="block" styleClass="free_area0 endline">
		        			<a4j:repeat id="imagesList" var="image" value="#{EditImageMetadataBean.editor.images}" rowKeyVar="indexImage">
		        				<h:panelGroup styleClass="full_area0 itemBlock preListHeader">
			        				<h:panelGroup styleClass="huge_area0">
										<h:graphicImage alt="#{image.filename}" id="picThumbResolutionBrowse" url="#{Navigation.applicationUrl}coreserviceimage?imageUrl=#{image.thumbnailImageUrl}"/>
			        				</h:panelGroup>
			        				<h:panelGroup styleClass="half_area0" rendered="#{image.metadataSet.profile == EditImageMetadataBean.profile.id}">
				        				<a4j:repeat id="metadata" var="md" value="#{image.metadataSet.metadata}" rowKeyVar="indexMetadata">
				        					<h:panelGroup  rendered="#{md.namespace == EditImageMetadataBean.metadata.namespace}">
				        						<!-- Field -->
				        						<ui:include src="./picturesPages/ui/MetadataInput.xhtml">
													<ui:param name="metadata" value="#{md}"/>
													<ui:param name="editor" value="#{EditImageMetadataBean.editor}"/>
													<ui:param name="areaClass" value="quad_txtArea"/>
												</ui:include>
												<!-- BUTTONS -->
												<h:panelGroup layout="block">
													<a4j:commandLink styleClass="small_label" reRender="ajaxContent" action="#{EditImageMetadataBean.addMetadata}" value="#{lbl.add}">
														<f:setPropertyActionListener value="#{indexMetadata}" target="#{EditImageMetadataBean.mdPosition}" />
														<f:setPropertyActionListener value="#{indexImage}" target="#{EditImageMetadataBean.imagePosition}" />
													</a4j:commandLink>
													<a4j:commandLink  styleClass="small_label"  reRender="ajaxContent" action="#{EditImageMetadataBean.removeMetadata}" value="#{lbl.remove}">
														<f:setPropertyActionListener value="#{indexMetadata}" target="#{EditImageMetadataBean.mdPosition}" />
														<f:setPropertyActionListener value="#{indexImage}" target="#{EditImageMetadataBean.imagePosition}" />
													</a4j:commandLink>	
												</h:panelGroup>
				        					</h:panelGroup>
				        				</a4j:repeat>
			        				</h:panelGroup>
			        				<h:panelGroup rendered="#{image.metadataSet.profile != EditImageMetadataBean.profile.id}">
			        					<h:panelGroup styleClass="half_area0">
			        						<h:outputText value="This image is not editable with selected profile."/>
			        					</h:panelGroup>
			        				</h:panelGroup>
			        			</h:panelGroup>
		        			</a4j:repeat>
						</h:panelGroup>
			        </h:panelGroup>
	        	</a4j:outputPanel> 
			</h:panelGroup>
		</h:panelGroup>
	</ui:define>
</body>
</ui:composition>
</html>