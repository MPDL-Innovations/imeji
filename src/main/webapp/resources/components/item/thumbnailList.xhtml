<div xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:composite="http://java.sun.com/jsf/composite"
	xmlns:imj="http://java.sun.com/jsf/composite/components">
	<composite:interface>
		<composite:attribute name="picList"/>
	</composite:interface>
	<composite:implementation>
		<h:panelGroup layout="block" styleClass="imj_tiledMediaList" rendered="#{cc.attrs.picList.totalNumberOfElements != 0}">
			<ui:fragment rendered="#{Auth.loggedIn}">
				<div class="imj_listHeader">
					<div class="imj_overlayMenu">
						<h:form id="selectMenuForm">
							<div class="imj_menuHeader">
								<h:commandLink action="#{cc.attrs.picList.selectAll}"  id="lnkSelectAllOnPage" title="#{lbl.select_all}"  styleClass="selectAll" rendered="#{!cc.attrs.picList.allSelected}">
									<h:outputText value="#{lbl.select_all}"/>
									<f:ajax execute="this" render=":ajaxWrapper :actionsMenuArea"/>
								</h:commandLink>
								<h:commandLink action="#{cc.attrs.picList.selectNone}" id="lnkSelectNone" title="#{lbl.select_none}"  styleClass="selectNone" rendered="#{cc.attrs.picList.allSelected}">
									<h:outputText value="#{lbl.select_none}"/>
									<f:ajax execute="this" render=":ajaxWrapper :actionsMenuArea"/>
								</h:commandLink>
		                        &#160;
							</div>
						</h:form>
					</div>
				</div>
			</ui:fragment>
			<script>
					var lastHeight=0;
					var elementsPerLine=0;
					var done=false;
					function checkHeight(){
						if(!done){
							var height=document.getElementById("listDiv").clientHeight;
							if(elementsPerLine==0){
								lastHeight=height;
							}
							if(height>lastHeight){
								done=true;
							}
							else{
								elementsPerLine++;
							}
					}
					}
			</script>
			<div class="imj_listBody" id="listDiv">
				<ul id="imj_listBody">
					<!-- Images -->	
					<ui:repeat id="pictureList" var="item" value="#{cc.attrs.picList.currentPartList}" offset="0" varStatus="index">
						<li class="imj_tileItem" style="max-width:#{item.thumbnailWidth}px;">
							<ui:param name="uri" value="#{item.uri}"/>
							<h:form id="itemSelectForm">
								<h:panelGroup layout="block" id="imgFrame" styleClass="#{item.selected ? 'imj_selected'  : ''} imj_tileThumbnailArea" >
									<!-- Image with link to the details view -->
									<h:outputLink id="lnkPicDetailBrowse" value="#{cc.attrs.picList.imageBaseUrl}item/#{item.id}?q=#{cc.attrs.picList.query}&amp;pos=#{cc.attrs.picList.offset + index.index}">
										<h:graphicImage alt="#{item.caption}" title="#{item.caption}" id="thumbnail" url="#{item.link}"/>		
									</h:outputLink>
								</h:panelGroup>
								<!-- Browse / Search Result / All Pictures of one Person Pages / resource -->
								<span class="imj_optionSet">
									<ui:fragment rendered="#{Auth.loggedIn}">
										<h:selectBooleanCheckbox styleClass="imj_optionCheckbox" id="pictureCheckbox" value="#{item.selected}" valueChangeListener="#{item.selectedChanged}">
											<f:ajax event="change" execute="@this" render="@form :actionsMenuArea"/>
										</h:selectBooleanCheckbox>
									</ui:fragment>
									<h:outputLabel for="pictureCheckbox" value="#{item.caption}" title="#{item.caption}" styleClass="imj_optionLabel"/>
								</span>
							</h:form>
							<div class="imj_tooltip">
								<imj:thumbnailPopup item="#{item}"/>
							</div>
						</li>
						<script>checkHeight();</script>
					</ui:repeat>
					<!-- End images -->
					<!-- 
						Show/hide metadata popup Needs to be defined in ajax area to rebind the DOM objects
					-->
				</ul>
			</div>
			
		</h:panelGroup>
		<div id="log"></div>
		
		<script>
		document.cookie="BODY_WIDTH_COOKIE="+document.body.clientWidth;
		if(done){
			document.cookie="ELEMENTS_PER_LINE_COOKIE="+elementsPerLine;
		}
		</script>
	</composite:implementation>
</div>