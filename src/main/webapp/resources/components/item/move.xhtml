<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:composite="http://java.sun.com/jsf/composite"
	xmlns:html5="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:item="http://java.sun.com/jsf/composite/components/item"
	xmlns:imeji="http://java.sun.com/jsf/composite/components"
	xmlns:license="http://java.sun.com/jsf/composite/components/license">
	
	<composite:interface>
		<composite:attribute name="colId" required="true" type="java.lang.Object"/>
		<composite:attribute name="parentId" required="true" type="java.lang.Object"/>
		<composite:attribute name="itemId" required="false" type="java.lang.Object"/>
		<composite:attribute name="hasLicense" default="false" required="false" type="java.lang.Boolean"/>
	</composite:interface>
	
	<composite:implementation>
		<div id="moveItemsDialog" class="imj_modalDialogBox imj_moveItemsDialogBox imj_confirmationText" style="display:none;">
			<h:form id="moveItemsForm">
				<ui:fragment rendered="#{MoveItemsBean.destinationId == null}">
					<div style="margin-bottom: 2em;">
						<span class="fa fa-globe fa-size-3" style="visibility: hidden">&#160;</span>
						<span>#{lbl.move_to_collection}</span>
						<a style="float:right" onclick="closeDialog('moveItemsDialog');" class="imj_cancelButton">
							#{lbl.cancel}
						</a>
					</div>
					<div>
						<span class="fa fa-globe fa-size-3" style="visibility: hidden">&#160;</span>
						<h:inputText value="#{MoveItemsBean.query}" html5:placeholder="#{lbl.filter}">
							<f:ajax render="#{cc.attrs.parentId}:moveItemsForm:list" event="keyup" listener="#{MoveItemsBean.searchCollectionsForMove(cc.attrs.colId)}"/>
						</h:inputText>
					</div>
					<ui:remove>
					<h:panelGroup layout="block" id="list">
						<ui:repeat var="col" value="#{MoveItemsBean.collectionsForMove}">
							<p>
								<ui:fragment rendered="#{col.status == 'RELEASED' and !cc.attrs.hasLicense}">
									<span class="fa fa-globe fa-size-3">&#160;</span>
									<h:commandLink value="#{col.title}" action="#{MoveItemsBean.setDestinationId(col.id.toString())}">
										<f:ajax render="@form"/>
									</h:commandLink>	
								</ui:fragment>
								<ui:fragment rendered="#{col.status == 'PENDING' or cc.attrs.hasLicense}">
									<span class="fa fa-globe fa-size-3" style="#{col.status == 'RELEASED' ? '' : 'visibility: hidden'}">&#160;</span>
									<h:commandLink rendered="#{cc.attrs.itemId != null}" value="#{col.title}" action="#{MoveItemsBean.moveItemTo(col.id.toString(), cc.attrs.itemId)}"  onclick="startLoader();closeDialog('moveItemsDialog');"/>	
									<h:commandLink rendered="#{cc.attrs.itemId == null}" value="#{col.title}" action="#{MoveItemsBean.moveSelectedTo(col.id.toString())}"  onclick="startLoader();closeDialog('moveItemsDialog');"/>
								</ui:fragment>
							</p>
						</ui:repeat>
					</h:panelGroup>
					</ui:remove>
					<h:panelGroup layout="block" id="tree">
						<imeji:moveTree tree="#{MoveItemsBean.tree}" colId="#{cc.attrs.colId}" itemId="#{cc.attrs.itemId}" hasLicense="#{cc.attrs.hasLicense}"/>
						
						<ui:remove>
						<ui:repeat var="node" value="#{MoveItemsBean.moveTree}">
							<p>
								<ui:fragment rendered="#{node.collection.status == 'RELEASED' and !cc.attrs.hasLicense}">
									<span class="fa fa-globe fa-size-3">&#160;</span>
									<h:commandLink value="#{node.collection.title}" action="#{MoveItemsBean.setDestinationId(node.collection.id.toString())}">
										<f:ajax render="@form"/>
									</h:commandLink>	
								</ui:fragment>
								<ui:fragment rendered="#{node.collection.status == 'PENDING' or cc.attrs.hasLicense}">
									<span class="fa fa-globe fa-size-3" style="#{node.collection.status == 'RELEASED' ? '' : 'visibility: hidden'}">&#160;</span>
									<h:commandLink rendered="#{cc.attrs.itemId != null}" value="#{node.collection.title}" action="#{MoveItemsBean.moveItemTo(node.collection.id.toString(), cc.attrs.itemId)}"  onclick="startLoader();closeDialog('moveItemsDialog');"/>	
									<h:commandLink rendered="#{cc.attrs.itemId == null}" value="#{node.collection.title}" action="#{MoveItemsBean.moveSelectedTo(node.collection.id.toString())}"  onclick="startLoader();closeDialog('moveItemsDialog');"/>
								</ui:fragment>
								<h:commandLink rendered="#{not empty node.children}" value="" action="#{MoveItemsBean.showChildren(node)}">
									<f:ajax render="@form"/>
									<span class="fa fa-plus"></span>
								</h:commandLink>					 
							</p>
						</ui:repeat>
						</ui:remove>
					</h:panelGroup>
				</ui:fragment>
				<ui:fragment rendered="#{MoveItemsBean.destinationId != null}">
					<span class="fa fa-exclamation-triangle"/>
					#{lbl.move_collection_released}
					<br/><br/>
					<license:licenseEditor licenseEditor="#{MoveItemsBean.licenseEditor}" containerId="#{cc.attrs.parentId}:moveItemsForm"/>
					<br/>
					<a href="" onclick="closeDialog('moveItemsDialog');" class="imj_cancelButton">
						#{lbl.cancel}
					</a>
					<h:commandButton rendered="#{cc.attrs.itemId != null}" class="imj_submitButton" value="#{lbl.move}" action="#{MoveItemsBean.moveItemTo(cc.attrs.itemId)}"  onclick="startLoader();closeDialog('moveItemsDialog');"/>	
					<h:commandButton rendered="#{cc.attrs.itemId == null}" class="imj_submitButton" value="#{lbl.move}" action="#{MoveItemsBean.moveSelectedTo()}"  onclick="startLoader();closeDialog('moveItemsDialog');"/>						
				</ui:fragment>
			</h:form>
		</div>
	</composite:implementation>
</html>