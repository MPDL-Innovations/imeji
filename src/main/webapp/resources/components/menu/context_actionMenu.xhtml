<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:composite="http://java.sun.com/jsf/composite">
	
	<composite:interface shortDescription="Menu for context interactions as sorting, filter, download, etc. / @require attributes: isUserLoggedIn, navBean">
		
		<composite:attribute name="isUserLoggedIn" type="java.lang.Boolean" default="false" required="true" shortDescription="@type: Boolean"/>
		<composite:attribute name="navBean" type="java.lang.Object" required="true" shortDescription="@type: Object, used for several URL paths"/>
		
		<composite:attribute name="sortBean" type="java.lang.Object" required="false" shortDescription="@type: Object, used for sorting elements (e.g. in bibliographic list - order elements ascending)"/>
		<composite:attribute name="filterBean" type="java.lang.Object" required="false" shortDescription="@type: Object, used for filtering elements (e.g. in bibliographic list - my items without withdrawed items)"/>
		
		<composite:attribute name="menuClass" type="java.lang.String" default="imj_contentSubMenu" required="false" shortDescription="@type: String, used for the component and will be extended with 'Item' for every menu entry, @default: imj_contentSubMenu"/>
		<composite:attribute name="contextId" type="java.lang.String" default="" required="false" shortDescription="@type: String, required for Download"/>
		<composite:attribute name="exportQuery" type="java.lang.String" default="" required="false" shortDescription="@type: String, @dependencies: contextId and navBean for Download"/>
		<composite:attribute name="collectionStatus" type="java.lang.String" default="PENDING" required="false" shortDescription="@type: String, for menu handling in case of withdraw, release, delete, ..."/>
		<composite:attribute name="curMainMenu" type="java.lang.String" default="" required="false" shortDescription="@type String, required to get the right download"/>
		<composite:attribute name="contextDownloadParam" type="java.lang.String" default="" required="false" shortDescription="@type String, e.g. &amp;col=abcdefghi"/>
		
		<composite:attribute name="isEditable" type="java.lang.Boolean" default="false" required="false" shortDescription="@type: Boolean, required to release, delete, withdraw item"/>
		<composite:attribute name="isDeletable" type="java.lang.Boolean" default="false" required="false" shortDescription="@type: Boolean, required to check if item is deletable"/>
		<composite:attribute name="isContentEditable" type="java.lang.Boolean" default="false" required="false" shortDescription="@type: Boolean, required to check if item are editable"/>
		<composite:attribute name="isContentDeletable" type="java.lang.Boolean" default="false" required="false" shortDescription="@type: Boolean, required to check if item are deletable"/>
		<composite:attribute name="isAdmin" type="java.lang.Boolean" default="false" required="false" shortDescription="@type: Boolean, required to check if user is admin of container"/>
		<composite:attribute name="hasContent" type="java.lang.Boolean" default="false" required="false" shortDescription="@type: Boolean, required to show menus (e.g. start page, content page)"/>
		<composite:attribute name="downloadEnabled" type="java.lang.Boolean" default="true" required="false" shortDescription="@type: Boolean, param to disable the download menu on special pages (e.g. on collection overview, ...))"/>
		<composite:attribute name="allowedToShare" type="java.lang.Boolean" default="false" required="false" shortDescription="@type: Boolean: depends on logged in status"/>
		<composite:attribute name="profileEditable" type="java.lang.Boolean" default="false" required="false" shortDescription="@type: Boolean: true if the profile ca be iedted on this page"/>
		
		<composite:attribute name="actionEnabled" type="java.lang.Boolean" default="true" required="false" shortDescription="@type: Boolean: check if action menu should be displayed"/>
		<composite:attribute name="activeMenu" type="java.lang.String" default="" required="false" shortDescription="@type String, e.g. active sub navigation Menu"/>
		
		
	</composite:interface>
	
	<composite:implementation>

		<div class="#{cc.attrs.menuClass.trim()}">
			
			<ui:fragment rendered="#{cc.attrs.isUserLoggedIn}">
				<div class="imj_overlayMenu #{cc.attrs.menuClass.trim()}Item">
					<div class="imj_menuHeader">
                        <span class="fa fa-plus">&#160;</span>
						<h:outputText value="#{lbl.new_menu}" styleClass="imj_headerEntry"/>
					</div>
					<div class="imj_menuBody">
						<ul class="imj_overlayMenuList">
							<ui:fragment rendered="#{Auth.sessionUser.allowedToCreateCollection}">
								<li>
									<h:outputLink value="#{cc.attrs.navBean.createCollectionUrl}?reset=1" title="#{lbl.collection_create}">
										<h:outputText value="#{lbl.collection_create}"/>
									</h:outputLink>
								</li>
							</ui:fragment>
							<li>
								<h:outputLink value="#{cc.attrs.navBean.createAlbumUrl}" title="#{lbl.album_create}">
									<h:outputText value="#{lbl.album_create}"/>
								</h:outputLink>
							</li>
							<ui:fragment rendered="#{Auth.sessionUser.admin}">
								<li>
									<a href="#{Navigation.applicationSpaceUrl}createuser" title="#{lbl.admin_user_new}">
										<h:outputText value="#{lbl.admin_user_new}"/>
									</a>
								</li>
								<li>
									<a href="#{Navigation.applicationSpaceUrl}createusergroup" title="#{lbl.admin_group_new}">
										<h:outputText value="#{lbl.admin_userGroup_new}" />
									</a>
								</li>
							</ui:fragment>
						</ul>
					</div>
				</div>
			</ui:fragment>
			
			<ui:fragment rendered="#{cc.attrs.navBean != null and cc.attrs.downloadEnabled}">					
					<div class="imj_overlayMenu #{cc.attrs.menuClass.trim()}Item">
						<div class="imj_menuHeader">
                            <span class="fa fa-download">&#160;</span>
							<h:outputText value="#{lbl.download}" styleClass="imj_headerEntry" title="#{lbl.download_selected}"/>
						</div>
						<div class="imj_menuBody">
							<ul class="imj_overlayMenuList">
								<ui:fragment rendered="#{cc.attrs.activeMenu != 'metadata'}">
									<li>
										<h:outputLink title="#{lbl.export_zip}" value="#{cc.attrs.navBean.applicationUrl}export?format=zip&amp;type=image&amp;n=10000&amp;space=#{SessionBean.selectedSpace}#{cc.attrs.contextDownloadParam.trim()}&amp;q=#{cc.attrs.exportQuery.trim()}" target="_blank">
											<h:outputText value="#{lbl.export_zip}"/>
										</h:outputLink>
									</li>
									<li>
										<h:outputLink title="#{lbl.export_rdf}" value="#{cc.attrs.navBean.applicationUrl}export?format=rdf&amp;type=image&amp;n=10000&amp;space=#{SessionBean.selectedSpace}#{cc.attrs.contextDownloadParam.trim()}&amp;q=#{cc.attrs.exportQuery.trim()}" target="_blank">
											<h:outputText value="#{lbl.export_rdf}"/>
										</h:outputLink>
									</li>
									<li>
										<h:outputLink title="#{lbl.export_native}" value="#{cc.attrs.navBean.applicationUrl}export?format=xml&amp;type=image&amp;n=10000&amp;space=#{SessionBean.selectedSpace}#{cc.attrs.contextDownloadParam.trim()}&amp;q=#{cc.attrs.exportQuery.trim()}" target="_blank">
											<h:outputText value="#{lbl.export_native}"/>
										</h:outputLink>
									</li>
								</ui:fragment>
								<ui:fragment rendered="#{cc.attrs.activeMenu == 'metadata'}">
									<li>
										<h:outputLink value="#{Navigation.applicationSpaceUrl}export?format=xml&amp;type=profile&amp;q=prof==&quot;#{metadataContextBean.profile}&quot;" target="_blank">
											<h:outputText value="#{lbl.download_profile_xml}"/>
										</h:outputLink>
									</li>
								</ui:fragment>
							</ul>
						</div>
					</div>
				</ui:fragment>
			
			<ui:fragment rendered="#{cc.attrs.isUserLoggedIn}">
				
				<h:panelGroup layout="block" styleClass="imj_overlayMenu #{cc.attrs.menuClass.trim()}Item" rendered="#{cc.attrs.filterBean != null}">
					<div class="imj_menuHeader">
                        <span class="fa fa-filter">&#160;</span>
						<h:outputText id="txtFilter" value="#{lbl.filter}" styleClass="imj_headerEntry"/>
					</div>
					<div class="imj_menuBody">
						<h:outputText value="#{lbl.filter_by}:" styleClass="imj_sectionHeadline imj_active"/>
						<h:form>
							<ul>
								<ui:repeat var="filterItem" value="#{cc.attrs.filterBean.filterMenu}" varStatus="fpos">
									<li>
										<h:commandLink action="#{cc.attrs.filterBean.setSelectedFilter(filterItem.value)}" value="#{filterItem.label}" onclick="window.location.href = '?f=' + this.value" styleClass="#{(cc.attrs.filterBean.selectedFilter == filterItem.value) ? 'imj_active' : ''}"/>
									</li>
								</ui:repeat>
							</ul>
						</h:form>
					</div>
				</h:panelGroup>
				
				<ui:fragment  rendered="#{cc.attrs.actionEnabled and (cc.attrs.isAdmin or cc.attrs.isDeletable) and cc.attrs.collectionStatus.trim().toUpperCase() != 'WITHDRAWN'}">
					<ui:fragment rendered="#{cc.attrs.allowedToShare}">
						<div class="imj_overlayMenu #{cc.attrs.menuClass.trim()}Item" id="sharingMenu">
							<div class="imj_menuHeader" >
	                            <span class="fa fa-share">&#160;</span>
								<h:outputText value="#{lbl.share}" styleClass="imj_headerEntry"/>
							</div>
							<div class="imj_menuBody">
								<ul class="imj_overlayMenuList">							
									<li class="#{curMenuClass}Item">
										<h:outputLink  id="actionMenuShareAlbum" rendered="#{cc.attrs.curMainMenu == 'album'}" value="#{cc.attrs.navBean.albumUrl}#{cc.attrs.contextId}/share" >
											<h:outputText value="#{lbl.album_share}" rendered="#{cc.attrs.curMainMenu == 'album'}"/>
										</h:outputLink>
										<h:outputLink   id="actionMenuShareCollection" rendered="#{cc.attrs.curMainMenu == 'collection'}" value="#{cc.attrs.navBean.collectionUrl}#{cc.attrs.contextId}/share">
											<h:outputText value="#{lbl.collection_share}" rendered="#{cc.attrs.curMainMenu == 'collection'}"/>
										</h:outputLink>
									</li>							
								</ul>
							</div>
						</div>
					</ui:fragment>
					<div class="imj_overlayMenu #{cc.attrs.menuClass.trim()}Item" id="editMenu">
						<div class="imj_menuHeader" >
                            <span class="fa fa-pencil">&#160;</span>
							<h:outputText value="#{lbl.edit}" styleClass="imj_headerEntry"/>
						</div>
						<div class="imj_menuBody">
							<ul class="imj_overlayMenuList">							
								<li class="#{curMenuClass}Item">
									<h:outputLink  id="actionMenuEditCollection" rendered="#{cc.attrs.curMainMenu == 'collection'}" value="#{cc.attrs.navBean.collectionUrl}#{cc.attrs.contextId}/edit?init=1">
										<h:outputText value="#{lbl.collection_edit_metadata}"/>
									</h:outputLink>
									<h:outputLink  id="actionMenuEditAlbum" rendered="#{cc.attrs.curMainMenu == 'album'}" value="#{cc.attrs.navBean.albumUrl}#{cc.attrs.contextId}/edit?init=1">
										<h:outputText value="#{lbl.album_share_album_edit}"/>
									</h:outputLink>
								</li>
								<ui:fragment rendered="#{cc.attrs.curMainMenu == 'collection' and  cc.attrs.hasContent and cc.attrs.profileEditable and metadataBean.profile == null or metadataBean.profile.statements.size() > 0}">	
									<li class="#{curMenuClass}Item">
										<h:outputLink  value="#{Navigation.profileUrl}#{metadataBean.profileId}/#{Navigation.editPath}?init=1&amp;col=#{metadataBean.id}" id="lnkSelectEdit3">
											<h:outputText value="#{lbl.profile_edit}"/>
										</h:outputLink>
									</li>
									
								</ui:fragment>
								<ui:fragment rendered="#{cc.attrs.curMainMenu == 'collection' and  cc.attrs.hasContent and cc.attrs.isContentEditable}">	
									<li class="#{curMenuClass}Item">
										<h:outputLink  value="#{Navigation.applicationSpaceUrl}edit?type=all&amp;c=#{cc.attrs.facetBean.collection.id}&amp;q=#{cc.attrs.facetBean.query}" id="lnkSelectEdit2">
											<h:outputText value="#{lbl.edit_all}"/>
										</h:outputLink>
									</li>
								</ui:fragment>			
							</ul>
						</div>
					</div>
					<div class="imj_overlayMenu #{cc.attrs.menuClass.trim()}Item" id="actionMenu">
						<div class="imj_menuHeader" >
                            <span class="fa fa-bars">&#160;</span>
							<h:outputText value="#{lbl.actions}" styleClass="imj_headerEntry"/>
						</div>
						<div class="imj_menuBody">
							<ul class="imj_overlayMenuList">		

								<ui:fragment rendered="#{cc.attrs.isAdmin and cc.attrs.collectionStatus.trim().toUpperCase() == 'PENDING' and cc.attrs.hasContent}">
									<li>
										<h:outputLink id="actionMenuRelease" value="#" onclick="openDialog('releaseMenuItemDialog');" title="#{lbl.collection_release}">
											<h:outputText value="#{lbl.collection_release}" rendered="#{cc.attrs.curMainMenu == 'collection'}"/>
											<h:outputText value="#{lbl.album_release}" rendered="#{cc.attrs.curMainMenu == 'album'}"/>
										</h:outputLink>
									</li>
								</ui:fragment>
								
								<ui:fragment rendered="#{cc.attrs.isAdmin and cc.attrs.collectionStatus.trim().toUpperCase() == 'RELEASED'}">
									<li>
										<h:outputLink id="actionMenuDiscard" value="#" onclick="openDialog('withdrawMenuItemDialog');" title="#{lbl.withdraw}">
											<h:outputText value="#{lbl.collection_withdraw}" rendered="#{cc.attrs.curMainMenu == 'collection'}"/>
											<h:outputText value="#{lbl.album_withdraw}" rendered="#{cc.attrs.curMainMenu == 'album'}"/>
										</h:outputLink>
									</li>
									
									<li>
										<h:outputLink id="lnkCreateDOI" value="#" onclick="openDialog('createDOIDialog');" title="#{lbl.createDOI}">
											<h:outputText value="#{lbl.createDOI}"/>
										</h:outputLink>
									</li>
								</ui:fragment>
								
								<ui:fragment rendered="#{cc.attrs.isDeletable}">
									<li>
										<h:outputLink id="actionMenuDelete" value="#" onclick="openDialog('deleteMenuItemDialog');">
											<h:outputText value="#{lbl.collection_delete}" rendered="#{cc.attrs.curMainMenu == 'collection'}"/>
											<h:outputText value="#{lbl.album_delete}" rendered="#{cc.attrs.curMainMenu == 'album'}"/>
										</h:outputLink>
									</li>
								</ui:fragment>
								<ui:fragment rendered="#{cc.attrs.isContentDeletable}">
									<li>
										<h:outputLink  value="#" onclick="openDialog('dialogDeleteAll')" 
															rendered="#{cc.attrs.collectionStatus.trim().toUpperCase() == 'PENDING'}">
											<h:outputText value="#{lbl.delete_all}"/>
										</h:outputLink>
										<h:outputLink value="#" onclick="openDialog('dialogWithdrawAll')"
														rendered="#{cc.attrs.collectionStatus.trim().toUpperCase() == 'RELEASED'}">
											<h:outputText value="#{lbl.withdraw_all}"/>
										</h:outputLink>
									</li>
								</ui:fragment>
								<ui:fragment rendered="#{cc.attrs.curMainMenu == 'collection'  and cc.attrs.profileEditable}">
									<li>
										<h:outputLink rendered="#{metadataBean.profile == null or metadataBean.profile.statements.size() == 0}" value="#{Navigation.applicationUrl}createprofile?warn=0&amp;col=#{metadataBean.collection.idString}&amp;redirect=view" title="#{lbl.add_profile}">
											<h:outputText value="#{lbl.add_profile}"/>
										</h:outputLink>
										<h:outputLink rendered="#{metadataBean.profile == null or metadataBean.profile.statements.size() > 0}" value="#{Navigation.applicationUrl}createprofile?warn=1&amp;col=#{metadataBean.collection.idString}&amp;redirect=view" title="#{lbl.profile_change}" >
											<h:outputText value="#{lbl.profile_change}"/>
										</h:outputLink>
									</li>
								</ui:fragment>
							</ul>
						</div>
					</div>
				</ui:fragment>
			</ui:fragment> <!-- END if user logged in -->
			
			<!-- Right side -->
						
			<h:panelGroup layout="block" styleClass="imj_overlayMenu imj_menuRight #{cc.attrs.menuClass.trim()}Item">
				<div class="imj_menuHeader">
                       <span class="fa fa-history">&#160;</span>
					<h:outputText id="txtHistory" value="#{lbl.history}" styleClass="imj_headerEntry"/>
				</div>
				<div class="imj_menuBody">
					<ul class="imj_overlayMenuList">
						<ui:repeat var="page" value="#{HistorySession.pages}" rows="0" varStatus="pos">
							<ui:fragment rendered="#{pos.index + 10 &gt; HistorySession.historySize}">
								<li class="#{curMenuClass}Item">
									<h:outputText value="#{pos.index}. "/>
									<h:outputLink value="#{page.completeUrlWithHistory}" title="#{page.internationalizedName.trim()}">
										<h:outputText value="#{page.internationalizedName}"/>
									</h:outputLink>
								</li>
							</ui:fragment>
						</ui:repeat>
					</ul>
				</div>
			</h:panelGroup>
			
		</div>
	</composite:implementation>
</html>