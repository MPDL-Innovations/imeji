<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:composite="http://java.sun.com/jsf/composite"
	xmlns:lic="http://java.sun.com/jsf/composite/components/license">
	
	<composite:interface componentType="StatusComponent">
		<composite:attribute name="browseButtonId"/>
		<composite:attribute name="collectionId"/>
	</composite:interface>
	
	<composite:implementation>
		<style>
			.uploadFileListEntry{
				line-height:normal;
				font-size: small;
			}
		</style>
		<script type="text/javascript" src="#{Navigation.applicationUrl}resources/plupload/2.1.2/js/plupload.full.min.js"></script>
				<script type="text/javascript">
					var uploader = new plupload.Uploader({
						runtimes : 'html5,flash,silverlight,html4',
						browse_button : '#{cc.attrs.browseButtonId}', // you can pass in id...
						container: document.getElementById('container'), // ... or DOM Element itself
						url : '#{Navigation.applicationUrl}stream?col=#{cc.attrs.collectionId}&amp;apiKey=#{SessionBean.user.apiKey}',
						max_file_size : '#{Configuration.uploadMaxFileSize}kb',
						multi_selection : true,
						dragdrop: true,
						drop_element: 'uploader',
						init: {
							PostInit: function() {
								document.getElementById('filelist').innerHTML = '';					
							},				
							FilesAdded: function(up, files) {
								document.getElementById('uploadTitle').innerHTML = '';		
								 plupload.each(files, function(file) {
						                document.getElementById('filelist').innerHTML += '<div id="' + file.id + '" class="uploadFileListEntry">' + file.name + ' (' + plupload.formatSize(file.size) + ') <b></b></div>';
						            });
								uploader.start();
							},
							UploadProgress: function(up, file) {
								document.getElementById(file.id).getElementsByTagName('b')[0].innerHTML = '<span>' + file.percent + "%</span>";
							},
							StateChanged: function(up) {
								// Called when the state of the queue is changed
								if( up.state == plupload.STOPPED){
									//report();
								}
							},
							Error: function(up, err) {
								document.getElementById(err.file.id).getElementsByTagName('b')[0].innerHTML = "\nError #" + err.code + ": " + err.message;
						    },
						}
					});
					uploader.init();
					function report(){
						window.location.href = location.pathname + "?done=1";
					}
				</script>
	</composite:implementation>
</html>