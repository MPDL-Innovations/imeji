<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:composite="http://java.sun.com/jsf/composite"
	xmlns:imjc="http://java.sun.com/jsf/composite/components"
	xmlns:mdprofile="http://java.sun.com/jsf/composite/components/mdProfile">

<composite:interface>
	<composite:attribute name="formularBean" required="true" />
	<composite:attribute name="formularContextBean" required="true" />
	<composite:attribute name="headline" required="true" />
</composite:interface>

<composite:implementation>

	<h:panelGroup layout="block" class="imj_mediaContainerEditMD">
		<h:form id="mediaContainerForm">
			<div class="imj_headline">
				<h3>
					<h:outputText value="#{cc.attrs.headline}" />
				</h3>
			</div>
			<div class="imj_descriptionArea">
				<!-- Title -->
				<div class="imj_metadataSet">
					<label class="imj_metadataLabel"> <h:outputText
							value="#{lbl.title} *" /> <span class="imj_noDisplay">: </span>
					</label>
					<h:inputText id="inputTitleText" styleClass="imj_metadataValue"
						value="#{cc.attrs.formularContextBean.metadata.title}" />
				</div>

				<!-- Description -->
				<div class="imj_metadataSet">
					<label class="imj_metadataLabel"> <h:outputText
							value="#{lbl.description}" /> <span class="imj_noDisplay">:
					</span>
					</label>
					<h:inputTextarea id="inputDescription"
						styleClass="imj_metadataValue"
						value="#{cc.attrs.formularContextBean.metadata.description}" />
				</div>
				
				<h:outputText value="* #{lbl.mandatory}" />
				
				<!-- Author data -->
				<ui:repeat id="persons" var="creator" value="#{cc.attrs.formularContextBean.metadata.persons}" varStatus="indexA">
					<h:panelGroup layout="block" styleClass="imj_authorMetadataSet">
						<div class="imj_sectionHeadline">
							<h4>
								<!-- Add/Remove Author buttons -->
								<span class="imj_inlineButtonGroup"> 
									<h:commandButton styleClass="imj_buttonAdd_16" title="#{lbl.add_author}" action="#{cc.attrs.formularBean.addAuthor(indexA.index)}">
										<f:ajax execute="@this" render="@form" />
									</h:commandButton>
									<h:commandButton styleClass="imj_buttonRemove_16" title="#{lbl.remove_author}" action="#{cc.attrs.formularBean.removeAuthor(indexA.index)}">
										<f:ajax execute="@this" render="@form" />
									</h:commandButton>
								</span>
								<h:outputText value=" #{lbl.author}" />
								<span class="imj_noDisplay">: </span>
							</h4>
						</div>
						
						<!-- The user of the person -->
						<imjc:person id="collectionAuthor" person="#{creator}" bean="#{cc.attrs.formularBean}" position="#{indexA.index}" />

					</h:panelGroup>
				</ui:repeat>
		<!-- START NEW FEATURE -->
				<h:panelGroup layout="block" id="previewArea"  rendered="#{cc.attrs.formularBean.modeCreate}">
					<div class="imj_metadataSet" id="newProfileName">
						<h:outputLabel styleClass="imj_metadataLabel" for="mdProfileTitle">
							<h:outputText value="#{lbl.profile_name}"/>
							<span class="imj_noDisplay">: </span>
						</h:outputLabel>
						<h:inputText value="#{cc.attrs.formularBean.profile.title}" id="mdProfileTitle"  styleClass="imj_metadataValue"/>
					</div>
					<h:selectBooleanCheckbox  id="useTemplate" value="#{cc.attrs.formularBean.useMDProfileTemplate}">
						<f:ajax event="change" execute="@this" render="previewArea submitButtonPanel" />
					</h:selectBooleanCheckbox>
					<label for="useTemplate">#{lbl.profile_use_template}</label>
					
					<ui:fragment rendered="#{cc.attrs.formularBean.useMDProfileTemplate}">
		
						<div>
							<h:selectOneMenu id="profileTemplates" value="#{cc.attrs.formularBean.selectedProfileItem}" >
								<f:ajax  execute="@this" render="previewArea" listener="#{cc.attrs.formularBean.profileChangeListener}"/>
								<f:selectItems value="#{cc.attrs.formularBean.profileItems}"/>
							</h:selectOneMenu> 
						</div>					

						<h:panelGroup layout="block" id="metadataprofilepreview" >		
							<imjc:metadataProfile_view headline="#{lbl.collection_profile}" metadataBean="#{cc.attrs.formularBean}" metadataContextBean="#{cc.attrs.formularBean.collection}" 
									metadataProfile="#{cc.attrs.formularBean.profileTemplate}"/>
						</h:panelGroup>
														

				<ui:remove>  
					<mdprofile:profile_preview profileBean=""/> 
				</ui:remove>
			</ui:fragment>
		</h:panelGroup>
		<!-- START END FEATURE -->
		
			<h:panelGroup layout="block" id="submitButtonPanel" class="imj_submitPanel">
				<h:outputLink value="#{HistorySession.previousPage.completeUrlWithHistory}" styleClass="imj_cancelButton">
					<h:outputText value="#{lbl.cancel}"/>
				</h:outputLink>
				<h:commandButton action="#{cc.attrs.formularBean.saveAndEditProfile()}" value="#{lbl.save_and_edit_profile}" styleClass="imj_submitButton" onclick="openDialog('dialogWait');" rendered="#{cc.attrs.formularBean.useMDProfileTemplate}"/>				
				<h:commandButton action="#{cc.attrs.formularBean.save()}" value="#{lbl.save}" styleClass="imj_submitButton" onclick="openDialog('dialogWait');"/>
			</h:panelGroup>
		
			</div>
		
		
			

		</h:form>
	</h:panelGroup>
</composite:implementation>
</html>