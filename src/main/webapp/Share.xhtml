<ui:composition template="templates/template_site.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:menu="http://java.sun.com/jsf/composite/components/menu">
	
	<ui:param name="headline" value="#{lbl.share.toString().trim()}:" />
	<ui:param name="headlineSecondRow" value="#{ShareBean.title}"/>
	<ui:param name="currentMainMenu" value="#{(ShareBean.isCollection()) ? 'collection' : 'album'}"/>
	<ui:param name="contUrl" value="#{(ShareBean.isCollection()) ?  Navigation.collectionUrl :Navigation.albumUrl}"/>
	
	<ui:define name="actionsMenu">
		<menu:context_subNavigation contextId="#{ShareBean.id}" 
									contextUrl="#{contUrl}" 
									curMainMenu="#{currentMainMenu}" 
									userHasAdminRights="#{Auth.admin}" 
									userHasEditRights="true" 
									hasContent="false" 
									navBean="#{Navigation}" 
									activeMenu="share" 
									allowedToShare="true"/>
	</ui:define>
	
	<ui:define name="mainContent">
		
		<ui:include src="./include/History.xhtml"/>
		
		<div class="imj_shareForm">
			<div class="imj_submitPanel">
				<h:commandButton value="Share With New Users" action="#" styleClass="imj_submitButton" type="button" onclick="$('#share').show();$(this).hide();"/>
			</div>
			<div id="share" class="imj_noDisplay">
				<h:form>
					<div class="imj_emailInput">
						<div class="imj_metadataSet">
							<h:outputLabel for="emailInput" styleClass="imj_metadataLabel" value="#{lbl.share_email}"/>
							<h:inputTextarea id="emailInput" value="#{ShareBean.emailInput}" styleClass="imj_metadataValue"/>	
						</div>
					</div>
					<div class="imj_submitPanel">
						<h:outputLink value="#{History.previousPage}" styleClass="imj_cancelButton" title="#{lbl.cancel}">
							<h:outputText value="#{lbl.cancel}"/>
						</h:outputLink>
						<h:commandButton value="#{lbl.btn_share_with}" action="#{ShareBean.checkInputEmail}" styleClass="imj_submitButton">
							<f:ajax execute="@form" render=":out @form"/>
						</h:commandButton>
					</div>
				</h:form>
				<h:panelGroup layout="block" styleClass="imj_metadataSet" id="out">
					<ui:fragment rendered="#{ShareBean.emailList.size() > 0}">
						<div class="imj_metadataLabel">
							<h:outputLabel value="#{lbl.share_collection_with}"/>
						</div>
						<div class="imj_metadataValue">
						<!-- here should come the top of the list -->
						</div>
						<h:form prependId="false">
							<ui:repeat value="#{ShareBean.emailList}" var="email">
								<div class="imj_metadataLabel">
									<h:outputText value="#{email}" />
								</div>
							</ui:repeat>
							<h:panelGroup layout="block" id="shareOptions" styleClass="imj_metadataValue">
								<h:selectManyCheckbox id="selectedGrants" class="selectGrants" value="#{ShareBean.selectedGrants}" layout="lineDirection" onclick="document.getElementById('checkGrants').click();">
									<f:selectItems value="#{ShareBean.grantItems}" />
								</h:selectManyCheckbox>
								<h:commandButton id="checkGrants" value="Check Grants" action="#{ShareBean.checkGrants(ShareBean.selectedGrants)}" styleClass="imj_noDisplay">
									<f:ajax execute="@form" render="@form"/>
								</h:commandButton>
							</h:panelGroup>
							<div class="imj_submitPanel">
								<h:commandButton value="#{lbl.reset}" title="#{lbl.reset}" action="#{ShareBean.reset}" styleClass="imj_cancelButton">
									<f:ajax render="@form"/>
								</h:commandButton>	
								<h:commandButton value="#{lbl.save}" action="#{ShareBean.save}" styleClass="imj_submitButton"/>	
							</div>
						</h:form>
					</ui:fragment>
				</h:panelGroup>
			</div>
			
			<!-- List of user with have Grants for the current container -->
			<div id="history" class="imj_metadataSet">
				<div class="imj_metadataLabel">	
					<h:outputLabel value="#{lbl.share_collection_with_message}"/>
				</div>
				<div class="imj_metadataValue">
				<!-- here should come the top of the list -->
				</div>
				<ui:repeat id="users" var="sh" value="#{ShareBean.sharedWith}" rows="0" varStatus="pos">
					<div class="imj_metadataLabel">
						<h:outputText value="#{sh.user.name}"/>
					</div>
					<h:form prependId="false">
						<div class="imj_metadataValue">
							<h:selectManyCheckbox id="role" value="#{sh.sharedType}" enabledClass="" layout="lineDirection" onclick="document.getElementById('users:#{pos.index}:checkGrants').click();">
								<f:selectItems value="#{ShareBean.grantItems}" />
							</h:selectManyCheckbox>
							<h:commandButton id="checkGrants" value="Check Grants" action="#{ShareBean.checkGrants(sh.sharedType)}" styleClass="imj_noDisplay">
								<f:ajax execute="@form" render="@form"/>
							</h:commandButton>
						</div>
						<div class="imj_submitPanel">
							<h:commandButton value="#{lbl.remove}" action="#{ShareBean.unshare(sh)}" styleClass="imj_cancelButton"/>
						</div>
					</h:form>
				</ui:repeat>
				<div class="imj_submitPanel">
					<h:form>
						<h:commandButton value="#{lbl.updateSharedWith}" action="#{ShareBean.updateSharedWith}"  styleClass="imj_submitButton"/>
					</h:form>
				</div>
			</div>
		</div>
	</ui:define>
</ui:composition>