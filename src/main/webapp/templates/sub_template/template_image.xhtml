<ui:composition template="../template_site.xhtml"  
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:imeji="http://java.sun.com/jsf/composite/components"
	xmlns:item="http://java.sun.com/jsf/composite/components/item"
	xmlns:dialog="http://java.sun.com/jsf/composite/components/dialogs">
	
	<ui:param name="headline" value="#{itemBean.image != null ? itemBean.image.filename: ''}"/>
	<ui:param name="title" value="#{headline}"/>
	<ui:param name="backwardClass" value="#{itemBean.browse.previous == null ? 'previousItem imj_deactivated' : 'previousItem'}"/>
	<ui:param name="forwardClass" value="#{itemBean.browse.next == null ? 'nextItem imj_deactivated' : 'nextItem'}"/>
	
	
	<ui:define name="authorization">
		#{Auth.init(itemBean.item)}
	</ui:define>
	
	<ui:define name="actionsMenu">
		<item:actionMenu id="actionItem" itemBean="#{itemBean}" rendered="#{itemBean.item.status.name() != 'WITHDRAWN'}"/>
	</ui:define>
	
	<!-- Main Content - Image Detail View -->
	<ui:define name="mainContent">

		<ui:fragment rendered="#{itemBean.image != null}">
			<!-- AJAX Wrapper - START -->
			<h:panelGroup layout="block" id="imj_ajaxWrapper" styleClass="imj_mediaEntryDetailPage">
				<ui:fragment rendered="#{Auth.read}">
				
					<!-- pagination top -->
					<h:panelGroup layout="block" id="paginatorTop" styleClass="imj_paginator">
						<h:panelGroup styleClass="imj_simplePageBrowser">
							<h:outputLink  value="#{itemBean.browse.previous}#pageTitle" styleClass="#{backwardClass}" disabled="#{itemBean.browse.previous == null}">
								<h:outputText value="#{lbl.paginator_previous}"/>
							</h:outputLink>
							
							<h:outputLink style="text-align: left" value="#{itemBean.browse.next}#pageTitle" styleClass="#{forwardClass}" disabled="#{itemBean.browse.next == null}">
								<h:outputText value="#{lbl.paginator_next}"/>
							</h:outputLink>
						</h:panelGroup>
					</h:panelGroup>
					<ui:include src="../component/images/image_details.xhtml"/>
				</ui:fragment>
			</h:panelGroup>
			
		</ui:fragment>
		
		 <ui:fragment rendered="#{itemBean.image == null}">
			<h:outputLink value="#{HistorySession.previousPage.url}" rendered="#{HistorySession.previousPage != null}">
				<h:outputText value="#{lbl.back_to_previous}" />
			</h:outputLink>		
		</ui:fragment>
	</ui:define>
	<ui:define name="additonalFooterScripts">
		<script type="text/javascript" src="#{Navigation.applicationUrl}resources/js/qrcode.js"/>
		<script type="text/javascript">
			jQuery(document).ready(function() {
				var qrHtml = document.getElementById('qr');
				if (qrHtml != null) {
					qrHtml.innerHTML = create_qrcode('#{itemBean.pageUrl}');
				}
			});
			
			var draw_qrcode = function(text, typeNumber, errorCorrectLevel) {
				document.write(create_qrcode(text, typeNumber, errorCorrectLevel) );
			};
			var create_qrcode = function(text, typeNumber, errorCorrectLevel, table) {
				var qr = qrcode(typeNumber || 10, errorCorrectLevel || 'L');
				qr.addData(text);
				qr.make();
				// return qr.createTableTag();
				return qr.createImgTag();
			};
		</script>
	</ui:define>
</ui:composition>