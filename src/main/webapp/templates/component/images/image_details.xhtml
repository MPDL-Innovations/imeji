<ui:composition 
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:imjc="http://java.sun.com/jsf/composite/components"
	xmlns:lic="http://java.sun.com/jsf/composite/components/license"
	xmlns:md="http://java.sun.com/jsf/composite/components/metadata"
	xmlns:item="http://java.sun.com/jsf/composite/components/item">
	
	<f:metadata>
		<f:event listener="#{ItemBean.preRenderView}"
             type="preRenderView" />
	</f:metadata>
	
	<!-- MediaDisplayContainer - START -->
	<h:panelGroup layout="block" style="max-heigth:#{itemBean.webResolutionMaxLength}px; " styleClass="imj_mediaDisplayContainer"  rendered="#{itemBean.image.status != 'WITHDRAWN'}" id="topPanel">
		<ui:fragment rendered="#{!itemBean.videoFile and !itemBean.audioFile and !itemBean.swcFile}">
			<h:form id="rotationForm">
				<h:inputHidden id="inputTextRotation" value="#{itemBean.rotation}" />
				<h:commandButton id="buttonUpdateRotation" value="update rotation hidden"  action="#{itemBean.updateRotation}" styleClass="imj_noDisplay">
					<f:ajax render="@none" execute="@form"/>
				</h:commandButton>
			</h:form>
			<ui:fragment rendered="#{itemBean.viewInOpenseadragon}">
			<center>
				<div id="seaDragonsButtons">
					<a id="zoominButton" class="fa fa-search-plus fa-size-2 imj_mediaEditPanelItem" />
					<a id="zoomoutButton" class="fa fa-search-minus fa-size-2 imj_mediaEditPanelItem" />
					<a id="fullscreenButton" class="fa fa-expand fa-size-2 imj_mediaEditPanelItem" />
					<a id="homeButton" class="fa fa-home fa-size-2 imj_mediaEditPanelItem" />
					<a id="rotateLeftButton" class="fa fa-rotate-left fa-size-2 imj_mediaEditPanelItem" />
					<a id="rotateRightButton" class="fa fa-rotate-right fa-size-2 imj_mediaEditPanelItem" />
				</div>				
				<div id="seadragon-viewer-full" style="height:#{itemBean.webResolutionMaxLength}px;" >
					<a id="lnkPicFullResolutionAlt" href="#{itemBean.originalFile}" target="_blank">
						<h:graphicImage id="picWebResolutionAlt" title="#{itemBean.image.filename}" alt="#{itemBean.image.filename}" value="#{itemBean.preview}" />
					</a>
				</div>	
			</center>
			</ui:fragment>
			<ui:fragment rendered="#{!itemBean.viewInOpenseadragon}">
			<center>
				<h:outputLink id="lnkDataViewer" value="#{Navigation.applicationUrl}dataviewer?id=#{itemBean.image.idString}" rendered="#{itemBean.viewInDataViewer}" target="_blank">
					<span class="fa fa-expand fa-size-2" />
				</h:outputLink>
	
				<h:outputLink id="lnkOriginalData" value="#{itemBean.originalFile}" target="_blank" rendered="#{!itemBean.viewInDataViewer and !itemBean.viewInOpenseadragon}" >
					<span class="fa fa-expand fa-size-2" />
				</h:outputLink>
			</center>
			
			<h:outputLink id="lnkPicInternalDataViewer" value="#{Navigation.applicationUrl}dataviewer?id=#{itemBean.image.idString}" target="_blank" rendered="#{itemBean.viewInDataViewer}">
				<h:graphicImage title="#{itemBean.image.filename}" alt="#{itemBean.image.filename}" value="#{itemBean.preview}" />
			</h:outputLink>
			<h:outputLink id="lnkPicFullResolution" value="#{itemBean.originalFile}" target="_blank" rendered="#{!itemBean.viewInOpenseadragon and !itemBean.viewInDataViewer}">
				 <h:graphicImage id="picWebResolution" title="#{itemBean.image.filename}" alt="#{itemBean.image.filename}" value="#{itemBean.preview}" /> 
			</h:outputLink>
			 
			</ui:fragment>
		</ui:fragment>
		
		<ui:fragment rendered="#{itemBean.videoFile}">
			<video id="imejiVideoPlayer" poster="#{itemBean.preview}" src="#{itemBean.originalFile}" controls="controls" 
			 preload="auto" height="264"></video>
		</ui:fragment>
		<ui:fragment rendered="#{itemBean.audioFile}">
			<audio id="imejiAudioPlayer"  src="#{itemBean.originalFile}" controls="controls" preload="auto" >
				<h:outputText value="#{lbl.playing} #{itemBean.image.filename} " />
			</audio>
		</ui:fragment>
		<ui:fragment rendered="#{itemBean.image.status == 'WITHDRAWN'}">
			<div class="imj_mediaWithdrawn">
				<h:outputText value="#{lbl.withdraw_image_content}"/>
			</div>
		</ui:fragment>
		
		<ui:fragment rendered='#{itemBean.swcFile}'>
    		<imjc:swcViewer itemBean="#{itemBean}" swcID="swc3d" loadJSLibraries="true"/>
	    </ui:fragment>
		
	</h:panelGroup>
	<h:panelGroup layout="block" styleClass="imj_mediaDisplayContainer" rendered="#{itemBean.image.status == 'WITHDRAWN'}">
		<h:outputLink id="lnkPicFullResolution_Withdrawn" value="#">
			<h:graphicImage id="picWebResolution_Withdrawn" title="#{itemBean.image.filename}" alt="#{itemBean.image.filename}" value="#{Navigation.applicationUrl}resources/icon/discarded.png"/>
		</h:outputLink>
	</h:panelGroup>
	<span id="itemMetadata"/>
	<!-- MetaDataList - START -->
	<div class="imj_metadataList">
		<!-- MetaDataList - LIST BODY START -->
		<h:panelGroup id="metadata" layout="block" styleClass="imj_listBody">
			<!-- Edit Metadata -->
			<item:editMetadata id="editor" formBean="#{itemBean.editor}" itemBean="#{itemBean}" rendered="#{itemBean.edit and !itemBean.locked}"/>
			<!-- View metadata -->
			<item:viewMetadata id="viewer" itemBean="#{itemBean}"  rendered="#{!itemBean.edit}"/>
		</h:panelGroup>
	</div>
	<ui:fragment rendered="#{itemBean.viewInOpenseadragon}">
		<script src="#{Navigation.applicationUrl}/resources/openseadragon/openseadragon.min.js"></script>				
		<script type="text/javascript">				
	    			var imgFull = {
	    			type: 'image',
	    			url: '#{itemBean.fullResolution}',
	    			};
	   
	    			var viewerFull = OpenSeadragon({
	    
	        		id: "seadragon-viewer-full",
	        		tileSources: imgFull,
	        		showRotationControl: true,
	        		fullPageButton: "fullscreenButton",
	        		homeButton: "homeButton",
	        		zoomInButton: "zoominButton",
	        		zoomOutButton: "zoomoutButton",
	        		rotateRightButton: "rotateRightButton",
	        		rotateLeftButton: "rotateLeftButton",
	        		gestureSettingsTouch: {
	           		 pinchRotate: true
	        		}
	        		
	    		});
	    			viewerFull.addHandler('rotate',function(){
						 document.getElementById("rotationForm:inputTextRotation").value= viewerFull.viewport.getRotation();
						 document.getElementById("rotationForm:buttonUpdateRotation").click();
	        		});
	    			
	    			
	    			viewerFull.addHandler('open',function(){
	    				document.getElementById("picWebResolutionAlt").style.display='none';
	    			});
	    			
	    			viewerFull.addHandler("open-failed",function(){
	    				useAlternatePicture();
	    			});
	    			
	    			//Needed for Firefox
	    			var myDraw=false;
	    			viewerFull.addHandler("my-draw-failed",function(){
	    				if(!myDraw){
	    					useAlternatePicture();
	    				}
	    			});
	    			
	    			viewerFull.addHandler("my-draw",function(){
	    				myDraw=true;
	    			});
	    			
	    			function useAlternatePicture(){
	    				document.getElementById("picWebResolutionAlt").style.display='';
	    				viewerFull.setVisible(false);
	    				document.getElementById("buttons").style.display='none';
	    			}
		</script>
	</ui:fragment>
</ui:composition>