<ui:composition 
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:imjc="http://java.sun.com/jsf/composite/components"
	xmlns:lic="http://java.sun.com/jsf/composite/components/license"
	xmlns:md="http://java.sun.com/jsf/composite/components/metadata"
	xmlns:item="http://java.sun.com/jsf/composite/components/item">
	
	<!-- MediaDisplayContainer - START -->
	<h:panelGroup layout="block" styleClass="imj_mediaDisplayContainer" rendered="#{itemBean.image.status != 'WITHDRAWN'}" id="topPanel">
		<ui:fragment rendered="#{!itemBean.videoFile and !itemBean.audioFile and !itemBean.swcFile}">
			<h:form id="rotationForm">
				<h:inputHidden id="inputTextRotation" value="#{itemBean.rotation}" />
				<h:commandButton id="buttonUpdateRotation" value="update rotation hidden"  action="#{itemBean.updateRotation}" styleClass="imj_noDisplay">
					<f:ajax render="@none" execute="@form"/>
				</h:commandButton>
			</h:form>
		
			<ui:fragment rendered="#{itemBean.viewInOpenseadragon}">
			
				<h:outputLink id="zoominButton" class="fa fa-search-plus fa-size-3 imj_mediaEditPanelItem" /> &#160;
				<h:outputLink id="zoomoutButton" class="fa fa-search-minus fa-size-3 imj_mediaEditPanelItem" /> &#160;
				<h:outputLink id="fullscreenButton" class="fa fa-expand fa-size-3 imj_mediaEditPanelItem" /> &#160;
				<h:outputLink id="homeButton" class="fa fa-home fa-size-3 imj_mediaEditPanelItem" /> &#160;
				<h:outputLink id="rotateLeftButton" class="fa fa-rotate-left fa-size-3 imj_mediaEditPanelItem" /> &#160;
				<h:outputLink id="rotateRightButton" class="fa fa-rotate-right fa-size-3 imj_mediaEditPanelItem" />
			
			<center>
				<div id="seadragon-viewer-full" style="width:#{itemBean.webResolutionMaxLength}px; height:#{itemBean.webResolutionMaxLength}px;position:relative">
					<h:graphicImage id="picWebResolutionAlt" style="position:absolute;top:#{itemBean.webResolutionTop}px;left:#{itemBean.webResolutionLeft}px;" title="#{itemBean.image.filename}" alt="#{itemBean.image.filename}" value="#{itemBean.preview}" />
				</div>
			</center>
			</ui:fragment>
			<h:outputLink id="lnkPicInternalDataViewer" value="#{Navigation.applicationUrl}dataviewer?id=#{itemBean.image.idString}" target="_blank" rendered="#{itemBean.viewInDataViewer}">
				<h:graphicImage title="#{itemBean.image.filename}" alt="#{itemBean.image.filename}" value="#{itemBean.preview}" />
			</h:outputLink>
			<h:outputLink id="lnkPicFullResolution" value="#{itemBean.originalFile}" target="_blank" rendered="#{!itemBean.viewInOpenseadragon and !itemBean.viewInDataViewer}">
				 <h:graphicImage id="picWebResolution" title="#{itemBean.image.filename}" alt="#{itemBean.image.filename}" value="#{itemBean.preview}" /> 
			</h:outputLink>
		</ui:fragment>
		<ui:fragment rendered="#{itemBean.videoFile}">
			<video id="imejiVideoPlayer" src="#{itemBean.originalFile}" controls="controls" 
			poster="#{itemBean.preview}" preload="auto" height="264"></video>
		</ui:fragment>
		<ui:fragment rendered="#{itemBean.audioFile}">
			<audio id="imejiAudioPlayer" src="#{itemBean.originalFile}" controls="controls" preload="auto">
				<h:outputText value="#{lbl.playing} #{itemBean.image.filename} " />
			</audio>
		</ui:fragment>
		<ui:fragment rendered="#{itemBean.image.status == 'WITHDRAWN'}">
			<div class="imj_mediaWithdrawn">
				<h:outputText value="#{lbl.withdraw_image_content}"/>
			</div>
		</ui:fragment>
		
		<ui:fragment rendered='#{itemBean.swcFile}'>
    		<imjc:swcViewer itemBean="#{itemBean}" swcID="swc3d" loadJSLibraries="true"/>
	    </ui:fragment>
		<div style="float:right">
			<h:outputLink id="lnkDataViewer" value="#{Navigation.applicationUrl}dataviewer?id=#{itemBean.image.idString}" rendered="#{itemBean.viewInDataViewer}" target="_blank">
				<span class="fa fa-expand fa-size-4 imj_mediaEditPanelItem" />
			</h:outputLink>

			<h:outputLink id="lnkOriginalData" value="#{itemBean.originalFile}" target="_blank" rendered="#{!itemBean.viewInDataViewer and !itemBean.viewInOpenseadragon}" >
				<span class="fa fa-expand fa-size-4 imj_mediaEditPanelItem" />
			</h:outputLink>
		</div>	
	</h:panelGroup>

	<h:panelGroup layout="block" styleClass="imj_mediaDisplayContainer" rendered="#{itemBean.image.status == 'WITHDRAWN'}">
		<h:outputLink id="lnkPicFullResolution_Withdrawn" value="#">
				<h:graphicImage id="picWebResolution_Withdrawn" title="#{itemBean.image.filename}" alt="#{itemBean.image.filename}" value="#{Navigation.applicationUrl}resources/icon/discarded.png"/>
		</h:outputLink>
	</h:panelGroup>

		
	<span id="itemMetadata"/>
	<!-- MetaDataList - START -->
	<div class="imj_metadataList">
		<!-- MetaDataList - LIST BODY START -->
		<h:panelGroup id="metadata" layout="block" styleClass="imj_listBody">
			<!-- Edit Metadata -->
			<ui:fragment rendered="#{itemBean.edit and !itemBean.locked}">
				<h:form id="editItem">
					<div class="imj_metadataSet">
						<div class="imj_metadataLabel">
							#{lbl.filename}
							<span class="imj_invisible">: </span>
						</div>
						<div class="imj_metadataValue">
							<h:inputText value="#{itemBean.newFilename}"/>
						</div>					
					</div>
					<div class="imj_metadataSet">
						<div class="imj_metadataLabel">
							#{lbl.license}
							<span class="imj_invisible">: </span>
						</div>
						<div class="imj_metadataValue">
							<h:panelGroup id="licenseEditor">
								<lic:licenseEditor licenseEditor="#{EditMetadataItemBean.licenseEditor}" containerId=":editItem:licenseEditor"/>
							</h:panelGroup>
						</div>
					</div>
					<item:editMetadata formBean="#{EditMetadataItemBean}"/>
					<div class="imj_submitPanel">
						<h:commandLink styleClass="imj_cancelButton" action="#{itemBean.cancelEditor}">
							<h:outputText value="#{lbl.cancel}"/>
						</h:commandLink>
						<h:commandLink type="submit" styleClass="imj_submitButton" action="#{EditMetadataItemBean.save}" value="#{lbl.save}" actionListener="#{itemBean.cancelEditor}">
						</h:commandLink>
					</div>
				</h:form>
			</ui:fragment> 
			<!-- View metadata -->
			<ui:fragment rendered="#{!itemBean.edit}">
				<div class="imj_metadataWrapper">
					<div class="imj_globalMetadataSet">
						<h:panelGroup layout="block" styleClass="imj_metadataSet" style="color:red;" rendered="#{itemBean.image.status == 'WITHDRAWN'}">
							<div class="imj_metadataLabel">
								#{lbl.withdraw_comment}
								<span class="imj_invisible">: </span>
							</div>
							<div class="imj_metadataValue">
								#{itemBean.image.discardComment}
							</div>
						</h:panelGroup>
						<div class="imj_metadataSet">
							<div class="imj_metadataLabel">
								#{lbl.filename}
								<span class="imj_invisible">: </span>
							</div>
							<div class="imj_metadataValue">
								#{itemBean.image.filename}
							</div>					
						</div>
						<div class="imj_metadataSet">
							<div class="imj_metadataLabel">
								#{lbl.license}
								<span class="imj_invisible">: </span>
							</div>
							<div class="imj_metadataValue">
								<ui:repeat var="license" value="#{LicenseViewer.getLicensesSortedByDate(itemBean.image.licenses)}">
									<lic:licenseViewer license="#{license}" showLogo="#{license.end &lt; 0}"/>
									<br/>
								</ui:repeat>
								<h:outputText value="#{lbl.no_license}" rendered="#{empty itemBean.image.licenses}"/>
							</div>
						</div>
						<div class="imj_metadataSet">
							<div class="imj_metadataLabel">
								#{lbl.collection}
								<span class="imj_invisible">: </span>
							</div>
							<div class="imj_metadataValue">
								<a href="#{Navigation.collectionUrl}#{itemBean.collection.idString}">
									#{itemBean.collection.title}"
								</a>
							</div>
						</div>
						<!-- MetaDataList - File Size -->
						<div class="imj_metadataSet">
							<div class="imj_metadataLabel">
								#{lbl.file_size}
								<span class="imj_invisible">: </span>
							</div>
							<div class="imj_metadataValue">
								#{itemBean.image.fileSizeHumanReadable}
							</div>
						</div>
						<!-- MetaDataList - image dimension Size -->
						<h:panelGroup layout="block" styleClass="imj_metadataSet" rendered="#{itemBean.content.width &gt; 0 and itemBean.content.height &gt; 0}">
							<div class="imj_metadataLabel">
								#{lbl.width} x #{lbl.height}
								<span class="imj_invisible">: </span>
							</div>
							<div class="imj_metadataValue">
								#{itemBean.content.width} x #{itemBean.content.height}
							</div>
						</h:panelGroup>
						<ui:repeat var="metadata" value="#{itemBean.item.metadata}" rows="0">
							<div class="imj_metadataSet">
								<div class="imj_metadataLabel">
									#{metadata.statementId}
									<span class="imj_invisible">: </span>
								</div>
								<div class="imj_metadataValue">
									<md:output metadata="#{metadata}"/>
								</div>
							</div>
						</ui:repeat>
						<!-- InfoDataList - MD5 -->
						<div class="imj_metadataSet">
							<div class="imj_metadataLabel">
								#{lbl.checksum} (MD5)
								<span class="imj_invisible">: </span>
							</div>
							<div class="imj_metadataValue">
								#{itemBean.content.checksum}
								<a href="#{Navigation.browseUrl}?q=checksum=%22#{itemBean.content.checksum}%22"> [#{lbl.search_for_duplicate}]</a>
							</div>
						</div>
						<div class="imj_metadataSet">
							<div class="imj_metadataLabel">
								#{lbl.imageUploader}
								<span class="imj_invisible">: </span>
							</div>
							<div class="imj_metadataValue">
								#{itemBean.imageUploader}
							</div>
						</div>
						<div class="imj_metadataSet">
							<div class="imj_metadataLabel">
								#{lbl.imageUploadDate}
								<span class="imj_invisible">: </span>
							</div>
							<div class="imj_metadataValue">
								#{itemBean.image.created.time.toString()}
							</div>
						</div>
						<div class="imj_metadataSet">
							<div class="imj_metadataLabel">
								#{lbl.files}
								<span class="imj_invisible">: </span>
							</div>
							<div class="imj_metadataValue">
								#{itemBean.image.created.time.toString()}
								<ul class="imj_optionList">
									<li>
										<h:outputLink value="#{itemBean.thumbnail}" target="_blank">
											<h:outputText value="#{lbl.imageSizesThumb}"/>
										</h:outputLink>
									</li>
									<li>
										<h:outputLink value="#{itemBean.preview}" target="_blank">
											<h:outputText value="#{lbl.imageSizesWeb}"/>
										</h:outputLink>
									</li>
									<li>
										<h:outputLink value="#{itemBean.fullResolution}" target="_blank">
											<h:outputText value="#{lbl.imageSizesFull}"/>
										</h:outputLink>
									</li>
									<li>
										<h:outputLink value="#{itemBean.originalFile}" target="_blank">
											<h:outputText value="#{lbl.imageSizesOrg}"/>
										</h:outputLink>
									</li>
								</ul>
							</div>
						</div>
						<ui:fragment rendered="#{itemBean.image.status == 'RELEASED'}">
							<div class="imj_metadataSet">
								<div class="imj_metadataLabel">
									#{lbl.embed}
									<span class="imj_invisible">: </span>
								</div>
								<div class="imj_metadataValue">
									<textarea class="imj_infodataValueEntryEmbed" onclick="this.select();">
										"&lt;a href='#{itemBean.pageUrl}' title='#{itemBean.image.filename}'&gt; &lt;img src='#{itemBean.preview}' alt='#{itemBean.image.filename}' title='#{itemBean.image.filename}'&gt;&lt;/a&gt;
									</textarea>
								</div>
							</div>
						</ui:fragment>
						<div class="imj_metadataSet">
							<div class="imj_metadataLabel">
								#{lbl.qrcode}
								<span class="imj_invisible">: </span>
							</div>
							<div class="imj_metadataValue">
								<span class="imj_infodataValue" id="qr"> </span>
							</div>
						</div>
						<div id="techmetadata" class="imj_techdataList">
							<ui:repeat id="techMd" var="techMd" value="#{itemBean.techMd}">
								<h:outputText value="#{techMd}" styleClass="imj_techdataEntry"/>
							</ui:repeat>
						</div>
					</div>
				</div>
			</ui:fragment>
		</h:panelGroup>
	</div>
	<script type="text/javascript" src="#{Navigation.applicationUrl}resources/js/qrcode.js"> </script>
	<script type="text/javascript">
		jQuery(document).ready(function() {
			var qrHtml = document.getElementById('qr');
			if (qrHtml != null) {
				qrHtml.innerHTML = create_qrcode('#{itemBean.pageUrl}');
			}
		});
		
		var draw_qrcode = function(text, typeNumber, errorCorrectLevel) {
			document.write(create_qrcode(text, typeNumber, errorCorrectLevel) );
		};
		var create_qrcode = function(text, typeNumber, errorCorrectLevel, table) {
			var qr = qrcode(typeNumber || 10, errorCorrectLevel || 'L');
			qr.addData(text);
			qr.make();
			// return qr.createTableTag();
			return qr.createImgTag();
		};
	</script>
	<script src="#{Navigation.applicationUrl}/resources/openseadragon/openseadragon.js"></script>
	<script type="text/javascript">

  			var img = {
  			type: 'legacy-image-pyramid',
  	   
  	    	levels: [
  	    		{	
      	    		url: '#{itemBean.thumbnail}',    	    	
      	    		height: #{itemBean.thumbnailWidth},
      	    		width: #{itemBean.thumbnailWidth}
      	    	},
  	    		{	
  	    		url: '#{itemBean.preview}',    	    	
  	    		height: #{itemBean.webResolutionHeight},
  	    		width: #{itemBean.webResolutionWidth}
  	    	    },
      	    	{	
      	    		url: '#{itemBean.fullResolution}',    	    	
      	    		height: #{itemBean.fullResolutionHeight},
      	    		width: #{itemBean.fullResolutionWidth}
      	    	}]
  			};
			
			var open=false;
				
    			var imgFull = {
    			type: 'image',
    			url: '#{itemBean.fullResolution}',
    			};
   
    	    	var img={
    	    	type: 'legacy-image-pyramid',			
    	    			
    	    	levels: [
        	    	{	
        	    		url: '#{itemBean.preview}',   	    	
        	    		height: #{itemBean.webResolutionHeight},
        	    		width: #{itemBean.webResolutionWidth}
        	    	    },
        	    	{	
        	    		url: '#{itemBean.fullResolution}',    	    	
        	    		height: #{itemBean.fullResolutionHeight},
        	    		width: #{itemBean.fullResolutionWidth}
        	    	}]
    			};

    			var viewerFull = OpenSeadragon({
    
        		id: "seadragon-viewer-full",
        		tileSources: imgFull,
        		showRotationControl: true,
        		fullPageButton: "fullscreenButton",
        		homeButton: "homeButton",
        		zoomInButton: "zoominButton",
        		zoomOutButton: "zoomoutButton",
        		rotateRightButton: "rotateRightButton",
        		rotateLeftButton: "rotateLeftButton",
        		gestureSettingsTouch: {
           		 pinchRotate: true
        		}
        		
    		});

    			viewerFull.addHandler('rotate',function(){
					 document.getElementById("rotationForm:inputTextRotation").value= viewerFull.viewport.getRotation();
					 document.getElementById("rotationForm:buttonUpdateRotation").click();
        		});
    			
    			
    			viewerFull.addHandler('open',function(){
    				document.getElementById("picWebResolutionAlt").style.display='none';
    			});
    			
    			viewerFull.addHandler("tile-drawn",function(){
    				alert("Here");
    			});
    			
 				
	</script>
	<script type="text/javascript">$(function(){highlighter();});</script>	
</ui:composition>