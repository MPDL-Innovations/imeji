<ui:composition
	template="templates/sub_template/template_image_tiledlist.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:imjc="http://java.sun.com/jsf/composite/components"
	xmlns:dialog="http://java.sun.com/jsf/composite/components/dialogs"
	xmlns:menu="http://java.sun.com/jsf/composite/components/menu"
	xmlns:col="http://java.sun.com/jsf/composite/components/collection"
	xmlns:upload="http://java.sun.com/jsf/composite/components/upload">

	<ui:param name="paginatorListSessionBean" value="#{CollectionItemsBean}" />
	<ui:param name="title" value="#{not empty CollectionItemsBean.query or not empty CollectionItemsBean.facetQueryString ? lbl.search_results : CollectionItemsBean.collection.title}" />
	<ui:param name="headline" value="#{title}" />
	<ui:param name="currentMainMenu" value="collection" />
	<ui:param name="browseToAllItemsUrl" value="#{Navigation.collectionUrl}#{CollectionItemsBean.id}?q=" />
	<ui:param name="imejiResource" value="#{CollectionItemsBean.collection}" />
	<ui:param name="backLink1" value="#{not empty CollectionItemsBean.query or not empty CollectionItemsBean.facetQueryString ? browseToAllItemsUrl : ''}"/>
	<ui:param name="backlinkTitle1" value="#{CollectionItemsBean.collection.title}"/>

	 <ui:define name="authorization">
		 #{Auth.init(CollectionItemsBean.collection)}
	 </ui:define>
	 <ui:define name="collectionAbout">
	 	<div class="imj_sectionTitle">
	 		<span>#{lbl.informations} </span>
			<a href="#pageTitle" onclick="return false;">
				<span class="moreCollection"  onclick="$('.collectionAboutContent').slideDown(300);$('.lessCollection').show(); $(this).hide();">
					<span class="fa fa-angle-right" />
				</span>
				<span class="lessCollection" style="display:none;" onclick="$('.collectionAboutContent').slideUp(300);$('.moreCollection').show(); $(this).hide();">
					<span class="fa fa-angle-down" /> 
				</span>
			</a>
		</div>
		<div class="imj_section"></div>
		<div class="collectionAbout">
			<div class="collectionAboutContent ">
				<ui:fragment rendered="#{Auth.update}">
				<div id="colInfosActions" class="imj_actionMenuArea">
					<a href="#{Navigation.collectionUrl}#{CollectionItemsBean.id}/edit" class="imj_menuButton imj_overlayMenu">
						<span class="fa fa-pencil"/> <span>#{lbl.collection_edit_metadata}</span>
					</a>
				</div>
			</ui:fragment>
				<ui:fragment rendered="#{CollectionItemsBean.collection.status == 'WITHDRAWN'}">
					<div class="imj_infodataSet imj_mediaWithdrawn">
						#{lbl.withdrawn}<br/>
						<h:outputText value="#{CollectionItemsBean.collection.discardComment}" escape="false"/>
					</div>
				</ui:fragment>
				<col:details bean="#{CollectionItemsBean}" applicationUrl="#{Navigation.applicationUrl}" lbl="#{lbl}"/>
			</div>
		</div>
	 </ui:define>
	 
	 <ui:define name="actionsMenu">
		<ui:fragment rendered="#{Auth.admin}">
			<a href="#{Navigation.collectionUrl}#{CollectionItemsBean.id}/share?q=#{CollectionItemsBean.query}&amp;fq=#{cc.attrs.collectionBean.facetQueryString}" class="imj_menuButton imj_overlayMenu">
				<span class="fa fa-users"/> <span>#{lbl.share}</span>
			</a>
			<ui:fragment rendered="#{WorkflowBean.release(CollectionItemsBean.collection)}">
				<h:form>
					<h:commandLink action="#{CollectionItemsBean.actionMenu.searchItemsWihoutLicense}" onclick="openDialog('releaseCollection');" styleClass="imj_menuButton imj_openUploadDialog">
						<f:ajax render=":actionCollection:releaseCollection:confirmationDialogForm"/>
						<span class="fa fa-globe"/> <span>#{lbl.release}</span>
					</h:commandLink>
				</h:form>
			</ui:fragment>
			<ui:fragment rendered ="#{Auth.admin and WorkflowBean.createDOI(CollectionItemsBean.collection)}">
				<h:outputLink value="#" onclick="openDialog('doiInput');" title="#{lbl.change_doi}" rendered="#{Auth.sysAdmin and not empty CollectionItemsBean.collection.doi}" class="imj_menuButton imj_overlayMenu">
					 <span class="fa fa-link"/> <span>#{lbl.change_doi}</span>
				</h:outputLink>
				<h:outputLink id="lnkCreateDOI" value="#" onclick="openDialog(#{Auth.sysAdmin ? '\'createDOI\'' : '\'getDOIDialog\''});" title="#{lbl.createDOI}" rendered="#{Configuration.doiServiceUrl != null and Configuration.doiServiceUrl != '' and empty CollectionItemsBean.collection.doi}" class="imj_menuButton imj_overlayMenu">
					 <span class="fa fa-link"/> <span>#{lbl.createDOI}</span>
				</h:outputLink>
				<h:outputLink id="lnkInputDOI" value="#" onclick="openDialog('doiInput');" title="#{lbl.createDOI}" rendered="#{Auth.sysAdmin and empty Configuration.doiServiceUrl and empty CollectionItemsBean.collection.doi}" class="imj_menuButton imj_overlayMenu">
					<span class="fa fa-link"/> <span>#{lbl.createDOI}</span>
				</h:outputLink>
			</ui:fragment>
			<ui:fragment rendered="#{WorkflowBean.withdraw(CollectionItemsBean.collection)}">
				<h:outputLink value="#" onclick="openDialog('withdrawCollection');" class="imj_menuButton imj_overlayMenu">
					 <span class="fa fa-ban"/> <span>#{lbl.withdraw}</span>
				</h:outputLink>
			</ui:fragment>
		</ui:fragment>
	 </ui:define>
	 
	 <ui:define name="itemActions">
	 	<div id="itemActions" class="imj_actionMenuArea">
	 		<ui:fragment rendered="#{Auth.update}">
				<h:form id="showUploadForm">
					<h:commandLink id="upload" rendered="#{Auth.update}" action="#{CollectionItemsBean.setShowUpload(false)}" value="" styleClass="imj_menuButton imj_openUploadDialog" onclick="openDialog('uploadDialog');">
						<f:ajax render=":additonalFooterScripts"/>
							<span class="fa fa-upload"/> <span>#{lbl.upload}</span>
					</h:commandLink>
				</h:form>
				<a href="#{Navigation.applicationUrl}editbatch?col=#{CollectionItemsBean.id}" class="imj_menuButton imj_overlayMenu">
					<span class="fa fa-pencil"/> <span>#{lbl.edit_all}</span>
				</a>
				<a href="#{Navigation.applicationUrl}edit/license?collection=#{CollectionItemsBean.id}"  class="imj_menuButton imj_overlayMenu">
					<span class="fa fa-copyright"/> <span>#{lbl.edit_all_licenses}</span>
				</a>
				<ui:fragment rendered="#{WorkflowBean.delete(CollectionItemsBean.collection)}">
					<a href="#" onclick="openDialog('deleteItems');"  class="imj_menuButton imj_overlayMenu">
						 <span class="fa fa-trash"/> <span>#{lbl.delete_all}</span>
					</a>
				</ui:fragment>
			</ui:fragment>
			
		</div>
		<dialog:confirmationDialog submitAction="deleteAll" bean="#{CollectionItemsBean}" confirmationText="#{msg.confirmation_delete_items}?" submitLabel="#{lbl.delete}" dialogId="deleteItems" />
		<upload:dialog colId="#{cc.attrs.collectionBean.collection.id.toString()}" id="uploadDialog" bean="#{cc.attrs.collectionBean}"/>
	 </ui:define>

	<ui:define name="searchQuery">
		<imjc:searchQueryDisplayArea searchBean="#{paginatorListSessionBean}"
			navBean="#{Navigation}"
			rendered="#{paginatorListSessionBean.simpleQuery != ''  or !paginatorListSessionBean.facetQuery.isEmpty()}"
			label="#{lbl.search_for} #{HistorySession.currentPage.getInternationalizedName(InternationalizationBean.locale)}" />
	</ui:define>
	
	<ui:define name="additonalFooterScripts">
		<script>
			jQuery(document).ready(function() {
				if(#{CollectionItemsBean.showUpload}){
					openDialog('uploadDialog');
				}
			});	
			var qrHtml = document.getElementById('qr'); 
			qrHtml.innerHTML = create_qrcode('{key:"#{SessionBean.user.apiKey}",col:"#{CollectionItemsBean.collection.id}"}');
		</script>
		
	</ui:define>
</ui:composition>
