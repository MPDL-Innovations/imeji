<ui:composition
	template="templates/sub_template/template_image_tiledlist.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:imjc="http://java.sun.com/jsf/composite/components"
	xmlns:dialog="http://java.sun.com/jsf/composite/components/dialogs"
	xmlns:menu="http://java.sun.com/jsf/composite/components/menu"
	xmlns:col="http://java.sun.com/jsf/composite/components/collection"
	xmlns:upload="http://java.sun.com/jsf/composite/components/upload">

	<ui:param name="paginatorListSessionBean" value="#{CollectionItemsBean}" />
	<ui:param name="title" value="#{not empty CollectionItemsBean.query or not empty CollectionItemsBean.facetQueryString ? lbl.search_results : CollectionItemsBean.collection.title}" />
	<ui:param name="headline" value="#{title}" />
	<ui:param name="currentMainMenu" value="collection" />
	<ui:param name="browseToAllItemsUrl" value="#{Navigation.collectionUrl}#{CollectionItemsBean.id}?q=" />
	<ui:param name="imejiResource" value="#{CollectionItemsBean.collection}" />
	<ui:param name="backLink1" value="#{not empty CollectionItemsBean.query or not empty CollectionItemsBean.facetQueryString ? browseToAllItemsUrl : ''}"/>
	<ui:param name="backlinkTitle1" value="#{CollectionItemsBean.collection.title}"/>

	 <ui:define name="authorization">
		 #{Auth.init(CollectionItemsBean.collection)}
	 </ui:define>
	 
	 <ui:define name="subHeadline">
	 	<ui:fragment rendered="#{paginatorListSessionBean.simpleQuery == ''  and paginatorListSessionBean.facetQuery.isEmpty()}">
		 	<span>#{CollectionItemsBean.numberOfItems} #{CollectionItemsBean.numberOfItems > 1 ? lbl.items : lbl.item}</span>
		 	<span class="imj_sep">|</span>
		 	<span>#{lbl.by} #{CollectionItemsBean.authorsShort}</span>
		 	<span class="imj_sep">|</span> 
		 	<a href="#actions">
				<span class="moreCollection"  onclick="$('.collectionAbout').slideDown(300);$('.lessCollection').show(); $(this).hide();">
					<span>#{lbl.more}</span><span class="fa fa-angle-right"/>
				</span>
			</a>
			<a href="#">
				<span class="lessCollection" style="display:none;" onclick="$('.collectionAbout').slideUp(300);$('.moreCollection').show(); $(this).hide();">
					<span>#{lbl.less}</span><span class="fa fa-angle-down"/>
				</span>
			</a>
		</ui:fragment>
	 </ui:define>
	 <ui:define name="collectionAbout">
		<div class="collectionAbout">
			<div class="imj_sectionTitle">
		 		<span>#{lbl.informations}</span>
		 		<a href="#">
					<span class="lessCollection" style="display:none;" onclick="$('.collectionAbout').slideUp(300);$('.moreCollection').show();$('.lessCollection').hide();">
						<span class="fa fa-angle-down"/>
					</span>
				</a>
			</div>
			<div class="imj_section"/>
			<br/>
			<ui:fragment rendered="#{CollectionItemsBean.collection.status == 'WITHDRAWN'}">
				<div class="imj_infodataSet imj_mediaWithdrawn">
					#{lbl.withdrawn}<br/>
					<h:outputText value="#{CollectionItemsBean.collection.discardComment}" escape="false"/>
				</div>
			</ui:fragment>
			<col:details bean="#{CollectionItemsBean}" applicationUrl="#{Navigation.applicationUrl}" lbl="#{lbl}"/>
			<div class="imj_sectionTitle">
		 		<span>#{lbl.items}</span>
			</div>
			<div class="imj_section"/>
		</div>
		
	 </ui:define>
	 
	 <ui:define name="actions">
		
		 	<ui:fragment rendered="#{Auth.update}">
		 		<h:form id="showUploadForm">
					<h:commandLink id="upload" rendered="#{Auth.update}" action="#{CollectionItemsBean.setShowUpload(false)}" value="" styleClass="imj_menuButton imj_overlayMenu imj_openUploadDialog" onclick="openDialog('uploadDialog');">
						<f:ajax render=":additonalFooterScripts"/>
						<span class="fa fa-upload"/> <span>#{lbl.upload}</span>
					</h:commandLink>
				</h:form>
				<a class="imj_menuButton imj_overlayMenu" onclick="openDialog('addSubCollection');">
					<span class="fa fa-plus"/> <span>#{lbl.subcollection}</span>
				</a>
				<ui:fragment rendered="#{CollectionItemsBean.collection.isSubCollection()}">
					<a class="imj_menuButton imj_overlayMenu" onclick="openDialog('editSubCollection');">
						<span class="fa fa-pencil"/> <span>#{lbl.edit}</span>
					</a>
				</ui:fragment>
				<ui:fragment rendered="#{!CollectionItemsBean.collection.isSubCollection()}">
					<a href="#{Navigation.collectionUrl}#{CollectionItemsBean.id}/edit" class="imj_menuButton imj_overlayMenu">
						<span class="fa fa-pencil"/> <span>#{lbl.edit}</span>
					</a>
				</ui:fragment>
			</ui:fragment>
			
		<span id="actionsReponsive" class="responsiveMenu">

			<a style="float:right; text-align: right;" href="#"  class="responsiveMenuCloseBtn responsiveMenuBtn imj_menuButton imj_overlayMenu" data-menu="actionsReponsive" >
				<span class="fa fa-times"/> <span>#{lbl.close}</span>
			</a>
			
			<ui:fragment rendered="#{Auth.admin}">
				<a href="#{Navigation.collectionUrl}#{CollectionItemsBean.id}/share?q=#{CollectionItemsBean.query}&amp;fq=#{CollectionItemsBean.facetQueryString}" class="imj_menuButton imj_overlayMenu">
					<span class="fa fa-users"/> <span>#{lbl.share}</span>
				</a>
				<ui:fragment rendered="#{WorkflowBean.release(CollectionItemsBean.collection)}">
					<h:form>
						<h:commandLink action="#{CollectionItemsBean.actionMenu.searchItemsWihoutLicense}" onclick="openDialog('releaseCollection');" styleClass="imj_menuButton imj_openUploadDialog">
							<f:ajax render=":releaseCollection:confirmationDialogForm"/>
							<span class="fa fa-globe"/> <span>#{lbl.release}</span>
						</h:commandLink>
					</h:form>
				</ui:fragment>
				<ui:fragment rendered ="#{Auth.admin and WorkflowBean.createDOI(CollectionItemsBean.collection)}">
					<h:outputLink value="#" onclick="openDialog('doiInput');" title="#{lbl.change_doi}" rendered="#{Auth.sysAdmin and not empty CollectionItemsBean.collection.doi}" class="imj_menuButton imj_overlayMenu">
						 <span class="fa fa-link"/> <span>#{lbl.change_doi}</span>
					</h:outputLink>
					<h:outputLink id="lnkCreateDOI" value="#" onclick="openDialog(#{Auth.sysAdmin ? '\'createDOI\'' : '\'getDOIDialog\''});" title="#{lbl.createDOI}" rendered="#{Configuration.doiServiceUrl != null and Configuration.doiServiceUrl != '' and empty CollectionItemsBean.collection.doi}" class="imj_menuButton imj_overlayMenu">
						 <span class="fa fa-link"/> <span>#{lbl.createDOI}</span>
					</h:outputLink>
					<h:outputLink id="lnkInputDOI" value="#" onclick="openDialog('doiInput');" title="#{lbl.createDOI}" rendered="#{Auth.sysAdmin and empty Configuration.doiServiceUrl and empty CollectionItemsBean.collection.doi}" class="imj_menuButton imj_overlayMenu">
						<span class="fa fa-link"/> <span>#{lbl.createDOI}</span>
					</h:outputLink>
				</ui:fragment>
				
			</ui:fragment>
			<ui:fragment rendered="#{Auth.delete}">
				<ui:fragment rendered="#{WorkflowBean.delete(CollectionItemsBean.collection)}">
					<h:outputLink value="#" onclick="openDialog('deleteCollection');" class="imj_menuButton imj_overlayMenu">
						 <span class="fa fa-trash"/> <span>#{lbl.delete}</span>
					</h:outputLink>
					<h:form>
						<h:commandLink id="moveCollection" rendered="#{CollectionItemsBean.collection.isSubCollection()}" action="#{MoveItemsBean.searchCollectionsForMove(CollectionItemsBean.collection.id.toString())}" onclick="openDialog('moveDialog');"  class="imj_menuButton imj_overlayMenu">
							<span class="fa fa-hand-o-right"/> <span>#{lbl.move}</span>
							<f:ajax render=":move:form"/>
						</h:commandLink>
					</h:form>
				</ui:fragment>
				<ui:fragment rendered="#{WorkflowBean.withdraw(CollectionItemsBean.collection)}">
					<h:outputLink value="#" onclick="openDialog('withdrawCollection');" class="imj_menuButton imj_overlayMenu">
						 <span class="fa fa-ban"/> <span>#{lbl.withdraw}</span>
					</h:outputLink>
				</ui:fragment>
			</ui:fragment>
			<ui:fragment rendered="#{Auth.delete and not CollectionItemsBean.collection.isSubCollection()}">
				<h:outputLink value="#" rendered="#{not CollectionItemsBean.isSubscribed()}" onclick="openDialog('subscribe');" class="imj_menuButton imj_overlayMenu">
						<span class="fa fa-envelope"/> <span>#{lbl.subscribe}</span>
				</h:outputLink>
				<h:outputLink value="#" rendered="#{CollectionItemsBean.isSubscribed()}" onclick="openDialog('unsubscribe');" class="imj_menuButton imj_overlayMenu">
					<span class="fa fa-times"/> <span>#{lbl.unsubscribe}</span>
				</h:outputLink>
			</ui:fragment>
			<ui:fragment rendered="#{Auth.update}">
				<div class="imj_overlayMenu imj_contentSubMenuItem imj_menuButton" id="menuCollection">
					<div class="imj_menuHeader">
		                  <span class="fa fa-files-o"/>
		                  <span class="imj_headerEntry"> #{lbl.items}</span>
		                  <span class="fa fa-angle-down"/>
					</div>
					<div class="imj_menuBody">
						<ul class="imj_overlayMenuList">
							<li>
								<a href="#{Navigation.applicationUrl}editbatch?col=#{CollectionItemsBean.id}" >
									<span class="fa fa-pencil"/> <span>#{lbl.edit_all}</span>
								</a>
							</li>
							<li>
								<a href="#{Navigation.applicationUrl}edit/license?collection=#{CollectionItemsBean.id}" >
									<span class="fa fa-copyright"/> <span>#{lbl.edit_all_licenses}</span>
								</a>
							</li>
							<ui:fragment rendered="#{WorkflowBean.delete(CollectionItemsBean.collection)}">
								<li>
									<a href="#" onclick="openDialog('deleteItems');"  >
										 <span class="fa fa-trash"/> <span>#{lbl.delete_all}</span>
									</a>
								</li>
							</ui:fragment>
						</ul>
					</div>
				</div>
			</ui:fragment>
		</span>
		<a href="#{Navigation.applicationUrl}exportServlet?format=folder&amp;col=#{CollectionItemsBean.collection.idString}&amp;q=#{CollectionItemsBean.query}" target="_blank" class="imj_menuButton imj_overlayMenu #{Auth.loggedIn ? '' : 'ghostButton'}">
			<span class="fa fa-download"/> <span class="imj_headerEntry">#{lbl.download_files}</span>
		</a>
		<a href="#" class="fa fa-ellipsis-h responsiveMenuBtn imj_menuButton imj_overlayMenu" data-menu="actionsReponsive" />
		<a href="#" class="fa fa-filter responsiveMenuBtn imj_menuButton imj_overlayMenu" style="float:right" data-menu="facetsArea" />

	 </ui:define>
	 
	 <ui:define name="modalDialogs_from_site">
	 	<h:panelGroup id="dialogs">
		 	<upload:dialog colId="#{CollectionItemsBean.collection.id.toString()}" id="uploadDialog" bean="#{CollectionItemsBean}"/>
		 	<dialog:confirmationDialog submitAction="deleteAll" bean="#{CollectionItemsBean}" confirmationText="#{msg.confirmation_delete_items}?" submitLabel="#{lbl.delete}" dialogId="deleteItems" />
		 	<col:subCollectionForm dialogId="addSubCollection" parentCollection="#{CollectionItemsBean.collection}"/>
		 	<col:subCollectionForm dialogId="editSubCollection" collection="#{CollectionItemsBean.collection}"/>
		 	<dialog:confirmationDialog submitAction="release" id="releaseCollection" bean="#{CollectionItemsBean.actionMenu}" confirmationText="#{msg.confirmation_release_collection}" confirmationText2="#{CollectionItemsBean.actionMenu.releaseMessage} " confirmationTextLicense="#{CollectionItemsBean.actionMenu.countOfItemsWithoutLicense &gt; 0 ? LicenseViewer.getLicense(Configuration.defaultLicense) : ''}" submitLabel="#{lbl.release}" dialogId="releaseCollection"/>
		 	<dialog:confirmationDialog submitAction="delete" bean="#{CollectionItemsBean.actionMenu}" confirmationText="#{msg.confirmation_delete_collection}?" submitLabel="#{lbl.delete}" dialogId="deleteCollection" />
		 	<dialog:confirmationReasonedDialog submitAction="withdraw" bean="#{CollectionItemsBean.actionMenu}" confirmationText="#{msg.confirmation_withdraw_collection}" submitLabel="#{lbl.withdraw}" dialogId="withdrawCollection"/>
		 	<dialog:confirmationDialog submitAction="subscribe" bean="#{CollectionItemsBean}" confirmationText="#{msg.confirmation_subscribe}" submitLabel="#{lbl.subscribe}" dialogId="subscribe" />
			<dialog:confirmationDialog submitAction="unsubscribe" bean="#{CollectionItemsBean}" confirmationText="#{msg.confirmation_unsubscribe}" submitLabel="#{lbl.unsubscribe}" dialogId="unsubscribe" />
		 	<dialog:dialogOptionDialog bean="#{CollectionItemsBean.actionMenu}" col="#{CollectionItemsBean.collection}" submitId1="doiInput" submitId2="getDOIDialog" confirmationText="#{empty CollectionItemsBean.collection.doi ? '' : msg.collection_has_doi_warning}" submitLabel1="#{lbl.createDOI_manually}" submitLabel2="#{lbl.createDOI_from_service}" dialogId="createDOI"/>
			<dialog:confirmationDialog submitAction="createDOI" col="#{CollectionItemsBean.collection}" bean="#{CollectionItemsBean.actionMenu}" confirmationText="#{msg.confirmation_create_DOI}" submitLabel="#{lbl.createDOI}" dialogId="getDOIDialog"/>
		 	<dialog:move id="move" objectId="#{CollectionItemsBean.collection.id.toString()}" colId="#{CollectionItemsBean.collection.id.toString()}" parentId=":move" />
	 	</h:panelGroup>
	 </ui:define>

	<ui:define name="searchQuery">
		<imjc:searchQueryDisplayArea searchBean="#{paginatorListSessionBean}"
			navBean="#{Navigation}"
			rendered="#{paginatorListSessionBean.simpleQuery != ''  or !paginatorListSessionBean.facetQuery.isEmpty()}"
			label="#{lbl.search_for} #{HistorySession.currentPage.getInternationalizedName(InternationalizationBean.locale)}" />
	</ui:define>
	
	<ui:define name="additonalFooterScripts">
		
		<script>
			jQuery(document).ready(function() {
				if(#{CollectionItemsBean.showUpload}){
					openDialog('uploadDialog');
				}
			});	
			var qrHtml = document.getElementById('qr'); 
			qrHtml.innerHTML = create_qrcode('{key:"#{SessionBean.user.apiKey}",col:"#{CollectionItemsBean.collection.id}"}');
		</script>
	
	</ui:define>
</ui:composition>
