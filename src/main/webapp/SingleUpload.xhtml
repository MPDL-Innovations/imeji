<ui:composition template="templates/template_site.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:list="http://java.sun.com/jsf/composite/components/list">
	
	<ui:param name="headline" value="# SingleUploadBean.title "/>
	<ui:define name="mainContent">
		<!-- Breadcrumb - History -->
		<ui:include src="./include/History.xhtml"/>
		
 

		<h:panelGroup layout="block" id="imj_ajaxWrapper" >

			<h:panelGroup layout="block" styleClass="imj_upload">
				
				<div class="imj_headline">
					<h2>
						<h:outputText value="#{lbl.uploadFiles}"/>
					</h2>
				</div>
				
				<h:form id="singleUpload">
					<h:panelGroup layout="block" id="selCols" styleClass="imj_inlineSelectionGroup">
						<span class="imj_selectionLabel">
							<h:outputText value="#{lbl.select_collection}"/>
						</span>
						<h:selectOneMenu id="collections" value="#{SingleUploadBean.selectedCollectionItem}" styleClass="imj_selectionBox">
							<f:selectItems value="#{SingleUploadBean.collectionItems}"/>
							<f:ajax event="change" execute="@this" render=":singleUpload:mdProfile" listener="#{SingleUploadBean.colChangeListener}"/>
						</h:selectOneMenu>
					</h:panelGroup>
					
					<div>
						<div id="filelist">Your browser doesn't have Flash, Silverlight or HTML5 support.</div>
						<br />
		
						<div id="container">
						    <a id="pickfiles" href="javascript:;">[Select files]</a> 
						    <a id="uploadfiles" href="javascript:;">[Upload files]</a>
						</div>
						
						<br />
	
						<script type="text/javascript" src="#{Navigation.applicationUrl}resources/plupload/2.1.2/js/plupload.full.min.js"></script>
						
						
						<script type="text/javascript">
			
						var uploader = new plupload.Uploader({
							runtimes : 'html5,flash,silverlight,html4',
							browse_button : 'pickfiles', // you can pass in id...
							container: document.getElementById('container'), // ... or DOM Element itself
							url : location.pathname  + "?start=1",
							max_file_size : '#{Configuration.uploadMaxFileSize}kb',
							multi_selection : false,
							init: {
								PostInit: function() {
									document.getElementById('filelist').innerHTML = '';					
									document.getElementById('uploadfiles').onclick = function() {
										uploader.start();
									};
								},
								
								FilesAdded: function(up, files) {
									plupload.each(files, function(file) {
										if(uploader.files.length > 0)
										{
											uploader.removeFile(file);
										}
										
										document.getElementById('filelist').innerHTML = '<div id="' + file.id + '">' + file.name + ' (' + plupload.formatSize(file.size) + ') <b></b></div>';
									});
								},
								
								UploadProgress: function(up, file) {
									document.getElementById(file.id).getElementsByTagName('b')[0].innerHTML = '<span>' + file.percent + "%</span>";
								},
								 StateChanged: function(up) {
										// Called when the state of the queue is changed
										if( up.state == plupload.STOPPED)
											report();
	
								},
							}
						});
						
						uploader.init();
						function report(){
							window.location.href = location.pathname + "?done=1";
						}
						
						</script>
					</div>
					
					<h:panelGroup id="techmetadata" layout="block" styleClass="imj_techdataList" rendered="#{SingleUploadBean.techMd.size()>0}">
						<ui:repeat id="techMd" var="techMd" value="#{SingleUploadBean.techMd}">
							<h:outputText value="#{techMd}" styleClass="imj_techdataEntry"/>
						</ui:repeat>
					</h:panelGroup>

					

				
					<h:panelGroup layout="block" id="mdProfile" styleClass="imj_metadataList">
						<ui:repeat id="superStatementBean" var="superStatementBean" value="#{SingleUploadBean.sts}" rows="0" varStatus="indexMetadata">	
								<!-- MetaDataList - edit panel container set -->
								<div class="imj_metadataSet">
									<div class="imj_metadataLabel">
										<h:outputText value="#{MetadataLabels.internationalizedLabels[superStatementBean.statement.id]}"/>
										<span class="imj_invisible">: </span>
									</div>
									<div class="imj_metadataValue" style="margin-left: #{superStatementBean.hierarchyLevel}em;">
										<!-- MetaDataInput -->
										<list:batchEditList_singleStatement itemBean="#{superStatementBean}" itemStatement="#{superStatementBean.statement}" itemLabelBean="#{MetadataLabels}" hideLabel="true" navBean="#{Navigation}" suggestBean="#{SuggestBean}"/>		
									</div>
								</div>
						</ui:repeat>
					</h:panelGroup>
					
					<h:commandButton value="#{lbl.save}" action="#{SingleUploadBean.save}"/>
				</h:form>
			</h:panelGroup>
		</h:panelGroup>
	</ui:define>
	

</ui:composition>